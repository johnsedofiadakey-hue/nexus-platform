{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/admin/src/components/maps/AdminHQMap.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Fix for default marker icons in Next.js\nconst fixIcons = () => {\n  if (typeof window !== 'undefined') {\n    // @ts-ignore\n    delete L.Icon.Default.prototype._getIconUrl;\n    L.Icon.Default.mergeOptions({\n      iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\n      iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n    });\n  }\n};\n\ninterface AdminHQMapProps {\n  shops: any[];\n}\n\nexport default function AdminHQMap({ shops }: AdminHQMapProps) {\n  const mapContainerRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<L.Map | null>(null);\n  const tileLayerRef = useRef<L.TileLayer | null>(null);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [mapStyle, setMapStyle] = useState<'STREET' | 'SATELLITE'>('STREET');\n\n  // LAYERS\n  const STREET_URL = 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png';\n  const SATELLITE_URL = 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';\n\n  useEffect(() => {\n    fixIcons();\n\n    if (!mapContainerRef.current) return;\n\n    // INITIALIZE MAP IF NEEDED\n    if (!mapInstanceRef.current) {\n      const map = L.map(mapContainerRef.current).setView([5.6037, -0.1870], 11);\n      mapInstanceRef.current = map;\n      setIsLoaded(true);\n    }\n\n    const map = mapInstanceRef.current;\n\n    // UPDATE TILE LAYER\n    if (tileLayerRef.current) {\n      map.removeLayer(tileLayerRef.current);\n    }\n\n    const newLayer = L.tileLayer(mapStyle === 'STREET' ? STREET_URL : SATELLITE_URL, {\n      attribution: mapStyle === 'STREET' ? '&copy; Carto' : '&copy; Esri World Imagery'\n    });\n\n    newLayer.addTo(map);\n    tileLayerRef.current = newLayer;\n\n    // UPDATE MARKERS (Clear and Re-add simple approach or keep them)\n    // For simplicity, we just keep adding them, but ideally we should manage a marker layer group.\n    // However, the previous code re-initialized the whole map on shops change. \n    // Let's stick to the layer update here, and handle markers separately if needed.\n    // Actually, looking at previous code, it added markers on mount. \n    // Let's separate markers logic or just ensure they persist.\n    // Since this effect depends on [shops, mapStyle], re-running it is okay IF we clear layers.\n    // BETTER APPROACH: Separate Tile Layer effect from Marker effect? \n    // Previous code: useEffect(() => { init map, add tiles, add markers, return cleanup }, [shops])\n\n    // Let's refactor slightly to separate concerns or handle the dependency change gracefully.\n    // We won't destroy the map on style change, just the tile layer.\n\n  }, [mapStyle]); // Run when style changes (and init map)\n\n  // SEPARATE EFFECT FOR MARKERS\n  useEffect(() => {\n    if (!mapInstanceRef.current || !shops.length) return;\n    const map = mapInstanceRef.current;\n\n    // Ideally clear existing markers first if we tracked them. \n    // For now, simpler to just add them (risk of duplication if shops change often, but this is admin view).\n    // We can use a LayerGroup to be clean.\n\n    const markerGroup = L.layerGroup().addTo(map);\n\n    shops.forEach(shop => {\n      if (shop.latitude && shop.longitude) {\n        L.marker([shop.latitude, shop.longitude])\n          .addTo(markerGroup)\n          .bindPopup(`<b>${shop.name}</b><br>${shop.location}`);\n      }\n    });\n\n    return () => {\n      map.removeLayer(markerGroup);\n    }\n  }, [shops, isLoaded]); // Re-run when shops change\n\n  // CLEANUP ON UNMOUNT ONLY\n  useEffect(() => {\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n    }\n  }, []);\n\n  return (\n    <div className=\"w-full h-full relative border border-slate-200 rounded-md overflow-hidden bg-slate-50 group\">\n      {/* üõ°Ô∏è Leaflet will attach specifically to this div */}\n      <div\n        ref={mapContainerRef}\n        className=\"w-full h-full\"\n        style={{ zIndex: 1 }}\n      />\n\n      {/* üéÆ CONTROLS */}\n      <div className=\"absolute bottom-4 left-4 z-[500] flex gap-2\">\n        <button\n          onClick={() => setMapStyle('STREET')}\n          className={`px-3 py-1 text-xs font-bold rounded shadow-lg backdrop-blur-md transition-all ${mapStyle === 'STREET' ? 'bg-blue-600 text-white' : 'bg-white/80 text-slate-600 hover:bg-white'}`}\n        >\n          Map\n        </button>\n        <button\n          onClick={() => setMapStyle('SATELLITE')}\n          className={`px-3 py-1 text-xs font-bold rounded shadow-lg backdrop-blur-md transition-all ${mapStyle === 'SATELLITE' ? 'bg-blue-600 text-white' : 'bg-white/80 text-slate-600 hover:bg-white'}`}\n        >\n          Satellite\n        </button>\n      </div>\n\n      {!isLoaded && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-slate-50 z-10\">\n          <Loader2 className=\"animate-spin text-slate-400\" size={20} />\n        </div>\n      )}\n    </div>\n  );\n}\n\nimport { Loader2 } from \"lucide-react\";"],"names":[],"mappings":"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"}}]
}