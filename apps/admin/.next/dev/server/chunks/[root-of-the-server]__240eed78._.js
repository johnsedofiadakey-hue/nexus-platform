module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[project]/apps/admin/src/lib/prisma.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "prisma",
    ()=>prisma
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs, [project]/node_modules/@prisma/client)");
;
/**
 * ðŸ›¡ï¸ SECURE PRISMA CLIENT CONFIGURATION
 * 
 * Database: Supabase PostgreSQL (Transaction Pooler)
 * Connection: Uses environment variables for security
 * Mode: Transaction pooling (pgbouncer=true required)
 */ const globalForPrisma = /*TURBOPACK member replacement*/ __turbopack_context__.g;
function getPrismaClient() {
    if (globalForPrisma.prisma) {
        return globalForPrisma.prisma;
    }
    // Build time: return a dummy client that will fail at runtime if used
    if (!process.env.DATABASE_URL) {
        // During build, create a minimal client that won't actually connect
        const client = new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__["PrismaClient"]({
            log: []
        });
        if ("TURBOPACK compile-time truthy", 1) {
            globalForPrisma.prisma = client;
        }
        return client;
    }
    // Runtime: create properly configured client
    const baseUrl = process.env.DATABASE_URL;
    const connectionUrl = baseUrl.includes("?") ? `${baseUrl}&pgbouncer=true&connection_limit=1` : `${baseUrl}?pgbouncer=true&connection_limit=1`;
    const client = new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__["PrismaClient"]({
        datasources: {
            db: {
                url: connectionUrl
            }
        },
        log: ("TURBOPACK compile-time truthy", 1) ? [
            "error",
            "warn"
        ] : "TURBOPACK unreachable"
    });
    if ("TURBOPACK compile-time truthy", 1) {
        globalForPrisma.prisma = client;
    }
    return client;
}
const prisma = getPrismaClient();
}),
"[project]/apps/admin/src/app/api/ai/performance-insight/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$6_react$2d$dom$40$19$2e$2$2e$4_react$40$19$2e$2$2e$4_$5f$react$40$19$2e$2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.1.6_react-dom@19.2.4_react@19.2.4__react@19.2.4/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/admin/src/lib/prisma.ts [app-route] (ecmascript)");
;
;
async function GET(request) {
    const { searchParams } = new URL(request.url);
    const userId = searchParams.get("userId");
    if (!userId) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$6_react$2d$dom$40$19$2e$2$2e$4_react$40$19$2e$2$2e$4_$5f$react$40$19$2e$2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "User ID required"
        }, {
            status: 400
        });
    }
    try {
        const user = await __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$admin$2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
            where: {
                id: userId
            },
            include: {
                sales: {
                    orderBy: {
                        createdAt: 'desc'
                    },
                    take: 50
                },
                attendance: {
                    orderBy: {
                        checkIn: 'desc'
                    },
                    take: 20
                },
                targets: {
                    where: {
                        status: 'ACTIVE'
                    },
                    take: 1
                },
                dailyReports: {
                    orderBy: {
                        createdAt: 'desc'
                    },
                    take: 5
                }
            }
        });
        if (!user) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$6_react$2d$dom$40$19$2e$2$2e$4_react$40$19$2e$2$2e$4_$5f$react$40$19$2e$2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "User not found"
            }, {
                status: 404
            });
        }
        const insights = generateInsights(user);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$6_react$2d$dom$40$19$2e$2$2e$4_react$40$19$2e$2$2e$4_$5f$react$40$19$2e$2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(insights);
    } catch (error) {
        console.error("AI_INSIGHT_ERROR:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$1$2e$6_react$2d$dom$40$19$2e$2$2e$4_react$40$19$2e$2$2e$4_$5f$react$40$19$2e$2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Analysis failed"
        }, {
            status: 500
        });
    }
}
function generateInsights(user) {
    const sales = user.sales || [];
    const attendance = user.attendance || [];
    const target = user.targets?.[0];
    const reports = user.dailyReports || [];
    // 1. Calculate Core Metrics
    const totalSales = sales.reduce((sum, s)=>sum + s.totalAmount, 0);
    const totalUnits = sales.length;
    const avgOrderValue = totalUnits > 0 ? totalSales / totalUnits : 0;
    const targetSalesGap = target ? Math.max(0, target.targetValue - totalSales) : 0;
    const targetSalesProgress = target ? totalSales / target.targetValue * 100 : 0;
    const lateCheckins = attendance.filter((a)=>{
        const hour = new Date(a.checkIn).getHours();
        return hour > 9; // Assuming 9 AM start
    }).length;
    // 2. Intelligence Heuristics
    let briefing = "";
    let tone = "informational";
    const recommendations = [];
    if (target) {
        if (targetSalesProgress >= 90) {
            briefing = `${user.name} is performing exceptionally well, having achieved ${targetSalesProgress.toFixed(1)}% of the sales target. `;
            tone = "positive";
            recommendations.push("Consider increasing targets for the next period to maintain momentum.");
        } else if (targetSalesProgress < 40) {
            briefing = `${user.name} is significantly behind sales targets (${targetSalesProgress.toFixed(1)}%). `;
            tone = "urgent";
            recommendations.push("Schedule a 1-on-1 review to identify blockers in the sales funnel.");
        } else {
            briefing = `${user.name} is on a steady trajectory with ${targetSalesProgress.toFixed(1)}% target completion. `;
            tone = "neutral";
        }
    } else {
        briefing = `No active targets set for ${user.name}. Currently maintaining a sales volume of ${totalUnits} units. `;
    }
    // Attendance Insights
    if (lateCheckins > 2) {
        briefing += `Consistency issues detected: ${lateCheckins} late check-ins in the last 20 shifts. `;
        recommendations.push("Address morning punctuality to maximize early-hour walk-ins.");
    }
    // Sales Quality Insights
    if (avgOrderValue < 500 && totalUnits > 10) {
        briefing += `Focus appears to be on high-volume, low-value inventory. `;
        recommendations.push("Coach on cross-selling premium accessories to increase Average Order Value.");
    }
    // Report Intel
    if (reports.length > 0) {
        const lastReport = reports[0];
        if (lastReport.marketIntel) {
            briefing += `Active in field intelligence gathering (latest report submitted ${new Date(lastReport.createdAt).toLocaleDateString()}).`;
        }
    }
    return {
        briefing,
        tone,
        metrics: {
            salesProgress: targetSalesProgress,
            avgOrderValue,
            consistencyScore: Math.max(0, 100 - lateCheckins * 10)
        },
        recommendations
    };
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__240eed78._.js.map