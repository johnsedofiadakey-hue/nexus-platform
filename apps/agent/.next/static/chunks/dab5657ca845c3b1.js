(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52736,e=>{"use strict";var t=e.i(87433),a=e.i(44440);let s=(0,a.createContext)(void 0);function l({children:e}){let[l,r]=(0,a.useState)(!0),[n,i]=(0,a.useState)("blue");return(0,a.useEffect)(()=>{let e=localStorage.getItem("nexus-theme-mode"),t=localStorage.getItem("nexus-theme-accent");e&&r("dark"===e),t&&i(t)},[]),(0,a.useEffect)(()=>{localStorage.setItem("nexus-theme-mode",l?"dark":"light"),localStorage.setItem("nexus-theme-accent",n)},[l,n]),(0,t.jsx)(s.Provider,{value:{darkMode:l,toggleDarkMode:()=>r(!l),accent:n,setAccent:i,themeClasses:{bg:l?"bg-slate-900":"bg-slate-50",text:l?"text-white":"text-slate-900",card:l?"bg-slate-800":"bg-white",border:l?"border-slate-700":"border-slate-100",nav:l?"bg-slate-900/80 backdrop-blur-md":"bg-white/80 backdrop-blur-md"}},children:e})}function r(){let e=(0,a.useContext)(s);if(!e)throw Error("useMobileTheme must be used within a MobileThemeProvider");return e}e.s(["MobileThemeProvider",()=>l,"useMobileTheme",()=>r])},3645,e=>{"use strict";var t=e.i(44440);let a=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let r=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:i="",children:o,iconNode:c,...d},u)=>(0,t.createElement)("svg",{ref:u,...l,width:s,height:s,stroke:e,strokeWidth:n?24*Number(r)/Number(s):r,className:a("lucide",i),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(o)?o:[o]])),n=(e,l)=>{let n=(0,t.forwardRef)(({className:n,...i},o)=>(0,t.createElement)(r,{ref:o,iconNode:l,className:a(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...i}));return n.displayName=s(e),n};e.s(["default",()=>n],3645)},83428,e=>{"use strict";let t=(0,e.i(3645).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],83428)},62924,(e,t,a)=>{t.exports=e.r(37109)},48703,e=>{"use strict";let t=(0,e.i(3645).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],48703)},73750,e=>{"use strict";let t=(0,e.i(3645).default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);e.s(["Home",()=>t],73750)},3214,e=>{"use strict";let t=(0,e.i(3645).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],3214)},60253,e=>{"use strict";let t=(0,e.i(3645).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],60253)},12997,e=>{"use strict";let t=(0,e.i(3645).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],12997)},10129,e=>{"use strict";let t=(0,e.i(3645).default)("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);e.s(["Smartphone",()=>t],10129)},23608,e=>{"use strict";let t=(0,e.i(3645).default)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);e.s(["LogOut",()=>t],23608)},88083,e=>{"use strict";let t="NEXUS_OFFLINE_QUEUE",a={enqueue:(e,s)=>{let l={id:crypto.randomUUID(),type:e,payload:s,createdAt:Date.now()},r=a.getAll();return r.push(l),localStorage.setItem(t,JSON.stringify(r)),l},getAll:()=>{try{return JSON.parse(localStorage.getItem(t)||"[]")}catch{return[]}},remove:e=>{let s=a.getAll().filter(t=>t.id!==e);localStorage.setItem(t,JSON.stringify(s))},clear:()=>{localStorage.removeItem(t)},count:()=>a.getAll().length};e.s(["SyncQueue",0,a])},72108,e=>{"use strict";let t=(0,e.i(3645).default)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);e.s(["WifiOff",()=>t],72108)},51954,e=>{"use strict";let t=(0,e.i(3645).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],51954)},63488,70619,e=>{"use strict";var t=e.i(3645);let a=(0,t.default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>a],63488);let s=(0,t.default)("signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]);e.s(["Signal",()=>s],70619)},48109,e=>{"use strict";let t=(0,e.i(3645).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);e.s(["MessageSquare",()=>t],48109)},43416,e=>{"use strict";let t=(0,e.i(3645).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],43416)},93192,e=>{"use strict";let t=(0,e.i(3645).default)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);e.s(["Package",()=>t],93192)},31387,e=>{"use strict";var t=e.i(87433),a=e.i(44440),s=e.i(98992);let l=(0,a.createContext)(void 0),r="nexus_mobile_identity",n="nexus_mobile_inventory",i="nexus_mobile_last_sync",o=new Map;function c({children:e}){let[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[m,p]=(0,a.useState)(!0),[x,f]=(0,a.useState)(null),[g,b]=(0,a.useState)(null);(0,a.useRef)(void 0);let y=(0,a.useRef)(null),v=(0,a.useCallback)(()=>{try{let e=localStorage.getItem(r),t=localStorage.getItem(n),a=localStorage.getItem(i);if(e&&t&&a){let s=new Date(a),l=Date.now()-s.getTime();if(l<3e5){let a=JSON.parse(e),r=JSON.parse(t);return d(a),h(r),b(s),console.log(`âœ… Cache loaded (age: ${Math.round(l/1e3)}s)`),!0}console.log(`â° Cache expired (age: ${Math.round(l/1e3)}s, max: ${300}s)`)}}catch(e){console.error("Cache load failed:",e)}return!1},[]),w=(0,a.useCallback)((e,t)=>{try{let a=new Date;localStorage.setItem(r,JSON.stringify(e)),localStorage.setItem(n,JSON.stringify(t)),localStorage.setItem(i,a.toISOString()),b(a)}catch(e){console.error("Cache save failed:",e)}},[]),k=(0,a.useCallback)(async()=>{if(!c?.shopId)return;let e=`inventory-${c.shopId}`;if(o.has(e))return console.log("â© Deduplicating inventory request"),o.get(e);try{let t=fetch(`/api/inventory?shopId=${c.shopId}&t=${Date.now()}`).then(e=>{if(e.ok)return e.json();throw Error(`HTTP ${e.status}`)}).then(e=>{let t=Array.isArray(e)?e:e.data||[];return h(t),c&&w(c,t),t}).finally(()=>{o.delete(e)});o.set(e,t),await t}catch(e){console.warn("âš ï¸ Background inventory sync failed:",e.message)}},[c,w]),j=(0,a.useCallback)(async(e=!1)=>{e&&p(!0),f(null);let t="mobile-init";if(o.has(t))return console.log("â© Deduplicating init request"),o.get(t);try{console.log("ðŸ“¡ Mobile Init: Fetching assignment data...");let e=(async()=>{let e=await fetch(`/api/mobile/init?t=${Date.now()}`,{credentials:"include"});if(!e.ok){if(401===e.status)throw console.error("âŒ Mobile Init: Authentication failed"),Error("AUTH_FAILED");if(409===e.status){console.error("âŒ Mobile Init: No shop assignment"),f("NO_SHOP_ASSIGNED"),s.toast.error("No shop assigned. Contact your manager.",{duration:5e3}),p(!1);return}throw console.error(`âŒ Mobile Init: Failed with status ${e.status}`),Error("Init failed")}let t=await e.json();if(console.log("âœ… Mobile Init: Assignment data received",{shopId:t.shopId,shopName:t.shopName,hasGPS:!!(t.shopLat&&t.shopLng)}),!t.shopId){console.error("âŒ Mobile Init: Response missing shopId"),f("NO_SHOP_ASSIGNED"),s.toast.error("Invalid shop assignment. Please contact support.",{duration:5e3}),p(!1);return}let a={id:t.id,agentName:t.agentName,agentImage:t.agentImage,shopId:t.shopId,shopName:t.shopName,managerName:t.managerName,managerPhone:t.managerPhone,shopLat:t.shopLat,shopLng:t.shopLng,radius:t.radius||100,targetProgress:t.targetProgress,bypassGeofence:t.bypassGeofence,lockout:t.lockout};y.current&&y.current!==t.shopId&&(console.log(`ðŸ”„ Shop Reassignment Detected: ${y.current} â†’ ${t.shopId}`),s.toast.success(`ðŸ”„ Reassigned to ${t.shopName}`,{duration:3e3}),h([])),y.current=t.shopId,d(a),console.log(`ðŸ“¦ Fetching inventory for shop: ${t.shopId}`);let l=await fetch(`/api/inventory?shopId=${t.shopId}&t=${Date.now()}`);if(l.ok){let e=await l.json(),t=Array.isArray(e)?e:e.data||[];console.log(`âœ… Inventory loaded: ${t.length} items`),h(t),w(a,t)}else console.warn("âš ï¸ Inventory fetch failed:",l.status),h([]),w(a,[])})().finally(()=>{o.delete(t),p(!1)});o.set(t,e),await e}catch(t){console.error("âŒ Mobile Data Sync Error:",t);let e="Connection error";"AUTH_FAILED"===t.message?(e="AUTH_FAILED",s.toast.error("Session expired. Please login again.",{duration:5e3})):t.message?.includes("fetch")||t.message?.includes("Failed to fetch")?(e="Network connection lost. Please check your internet.",s.toast.error("Network error. Retrying...",{duration:3e3})):t.message?.includes("timeout")?(e="Request timeout. Slow connection detected.",s.toast.error("Connection timeout. Please try again.",{duration:3e3})):s.toast.error("Sync failed. Pull to refresh.",{duration:3e3}),f(e),p(!1)}},[w]),N=(0,a.useCallback)((e,t)=>{h(a=>a.map(a=>a.id===e?{...a,...t}:a))},[]);return(0,a.useEffect)(()=>{let e;v()?(p(!1),j(!1)):j(!0);let t=12e4,a=()=>{e&&clearInterval(e),e=setInterval(()=>{k()},t)},s=()=>{document.hidden?(console.log("ðŸ“´ Tab hidden - reducing sync frequency"),t=6e5):(console.log("ðŸ“± Tab active - increasing sync frequency"),t=12e4,k()),a()};return document.addEventListener("visibilitychange",s),a(),()=>{e&&clearInterval(e),document.removeEventListener("visibilitychange",s)}},[v,j,k]),(0,t.jsx)(l.Provider,{value:{identity:c,inventory:u,loading:m,error:x,refreshData:j,refreshInventory:k,updateInventoryItem:N,lastSync:g},children:e})}function d(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useMobileData must be used within MobileDataProvider");return e}e.s(["MobileDataProvider",()=>c,"useMobileData",()=>d])},58481,e=>{"use strict";let t=(0,e.i(3645).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],58481)},65605,e=>{"use strict";var t=e.i(87433),a=e.i(62924),s=e.i(16595),l=e.i(52736),r=e.i(31387),n=e.i(44440),i=e.i(13370);function o({children:e}){let a=(0,n.useRef)(0),{status:s}=(0,i.useSession)();return(0,n.useEffect)(()=>{if("authenticated"!==s||!navigator.geolocation)return;if(!(window.isSecureContext||"localhost"===window.location.hostname))return void console.warn("GPS Insecure Context");let e=async(e,t)=>{let s=Date.now();if(!(s-a.current<3e4))try{(await fetch("/api/mobile/pulse",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({lat:e,lng:t})})).ok&&(a.current=s)}catch(e){}},t=navigator.geolocation.watchPosition(t=>{sessionStorage.setItem("nexus_gps_lat",t.coords.latitude.toString()),sessionStorage.setItem("nexus_gps_lng",t.coords.longitude.toString()),e(t.coords.latitude,t.coords.longitude)},e=>console.warn(e.message),{enableHighAccuracy:!0,maximumAge:0,timeout:2e4});return()=>navigator.geolocation.clearWatch(t)},[s]),(0,t.jsx)(t.Fragment,{children:e})}var c=e.i(98992),d=e.i(88083),u=e.i(3645);let h=(0,u.default)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);var m=e.i(72108),p=e.i(43416);function x(){let[e,a]=(0,n.useState)(!0),[s,l]=(0,n.useState)(!1),[r,i]=(0,n.useState)(0);(0,n.useEffect)(()=>{a(navigator.onLine),i(d.SyncQueue.count());let e=()=>{a(!0),o()},t=()=>a(!1);window.addEventListener("online",e),window.addEventListener("offline",t);let s=setInterval(()=>{i(d.SyncQueue.count()),navigator.onLine&&d.SyncQueue.count()>0&&o()},1e4);return()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t),clearInterval(s)}},[]);let o=async()=>{if(s||0===d.SyncQueue.count())return;l(!0);let e=c.toast.loading("Syncing Offline Data..."),t=d.SyncQueue.getAll(),a=0;for(let e of t)try{let t="";"REPORT"===e.type&&(t="/api/operations/reports"),"LEAVE"===e.type&&(t="/api/hr/leaves"),(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.payload)})).ok&&(d.SyncQueue.remove(e.id),a++)}catch(t){console.error("Sync Failed for item",e.id)}l(!1),i(d.SyncQueue.count()),a>0?c.toast.success(`Synced ${a} items`,{id:e}):c.toast.dismiss(e)};return 0===r&&e?null:(0,t.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-4 py-2 bg-slate-900/90 backdrop-blur text-white rounded-full shadow-xl border border-white/10",children:[e?s?(0,t.jsx)(p.RefreshCw,{size:14,className:"animate-spin text-blue-400"}):(0,t.jsx)(h,{size:14,className:"text-emerald-400"}):(0,t.jsx)(m.WifiOff,{size:14,className:"text-rose-400"}),(0,t.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:e?s?"Syncing...":`${r} Pending`:"Offline Mode"})]})}let f=(0,u.default)("shield-off",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);var g=e.i(48703);let b=(0,u.default)("phone-call",[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);var y=e.i(23608);function v({returnDate:e}){return(0,t.jsxs)("div",{className:"min-h-screen bg-slate-900 flex flex-col items-center justify-center p-8 text-center text-white",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-blue-600/20 rounded-full flex items-center justify-center mb-8 border border-blue-500/30",children:(0,t.jsx)(f,{className:"w-10 h-10 text-blue-500"})}),(0,t.jsx)("h1",{className:"text-2xl font-black tracking-tighter uppercase mb-2",children:"System Locked"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm uppercase font-bold tracking-widest mb-10 leading-relaxed",children:"Your access to the Nexus Grid has been temporarily suspended due to approved leave."}),(0,t.jsxs)("div",{className:"w-full bg-white/5 border border-white/10 rounded-2xl p-6 mb-10",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-white/10",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Return Date"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Calendar,{className:"w-4 h-4 text-blue-500"}),(0,t.jsx)("span",{className:"text-sm font-black tabular-nums",children:e})]})]}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("p",{className:"text-[9px] text-slate-500 font-bold uppercase tracking-widest mb-2",children:"Instructions"}),(0,t.jsx)("p",{className:"text-[11px] text-slate-300 leading-relaxed",children:"Please contact your LG Regional Supervisor if you are returning to your node earlier than expected."})]})]}),(0,t.jsxs)("div",{className:"w-full space-y-4",children:[(0,t.jsxs)("button",{className:"w-full py-4 bg-white text-slate-900 rounded-xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-3",children:[(0,t.jsx)(b,{className:"w-4 h-4"})," Contact Supervisor"]}),(0,t.jsxs)("button",{onClick:()=>(0,i.signOut)(),className:"w-full py-4 bg-white/5 text-slate-400 rounded-xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-3 border border-white/10",children:[(0,t.jsx)(y.LogOut,{className:"w-4 h-4"})," Sign Out"]})]})]})}var w=e.i(12997),k=e.i(51954),j=e.i(58481),N=e.i(63488),S=e.i(70619);function M({shopLat:e,shopLng:a,radius:s,bypass:l}){let[r,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(0),[u,h]=(0,n.useState)(null),[m,x]=(0,n.useState)(!0),[f,g]=(0,n.useState)(0),{data:b}=(0,i.useSession)(),y=()=>{if(x(!0),!navigator.geolocation){o(!0),x(!1);return}navigator.geolocation.getCurrentPosition(t=>{let r=t.coords.latitude,n=t.coords.longitude,i=t.coords.accuracy,c=v(r,n,e,a);if(d(c),h(i),i>50){console.warn(`GPS accuracy too low: ${i.toFixed(0)}m. Waiting for better signal...`),x(!1);return}c>s+30&&!l?g(e=>{let t=e+1;return t>=2&&o(!0),t}):(o(!1),g(0)),x(!1)},e=>{console.warn("GPS Error",e),x(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})};(0,n.useEffect)(()=>{y();let e=setInterval(y,3e4);return()=>clearInterval(e)},[e,a,s,l]);let v=(e,t,a,s)=>{let l=e*Math.PI/180,r=a*Math.PI/180,n=(a-e)*Math.PI/180,i=(s-t)*Math.PI/180,o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(l)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2);return Math.round(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371e3)};return(r||m)&&(!m||r)?(0,t.jsxs)("div",{className:"absolute inset-0 z-[9999] bg-slate-900/95 backdrop-blur-md flex flex-col items-center justify-center p-8 text-center animate-in fade-in duration-300",children:[(0,t.jsxs)("div",{className:"w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center mb-6 relative",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-red-500/20 rounded-full animate-ping"}),(0,t.jsx)(w.Lock,{className:"w-10 h-10 text-red-500 relative z-10"})]}),(0,t.jsx)("h2",{className:"text-2xl font-black text-white uppercase tracking-tight mb-2",children:"Terminal Locked"}),c>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"text-slate-400 font-medium mb-2 max-w-xs mx-auto",children:["You are ",(0,t.jsxs)("span",{className:"text-white font-bold",children:[c,"m"]})," away from the shop zone. Allowed radius is ",(0,t.jsxs)("span",{className:"text-white font-bold",children:[s,"m"]}),"."]}),null!==u&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs mb-6",children:[(0,t.jsx)(S.Signal,{className:`w-4 h-4 ${u<=20?"text-green-400":u<=50?"text-yellow-400":"text-red-400"}`}),(0,t.jsxs)("span",{className:"text-slate-500",children:["GPS Accuracy: ",(0,t.jsxs)("span",{className:`font-bold ${u<=20?"text-green-400":u<=50?"text-yellow-400":"text-red-400"}`,children:["Â±",u.toFixed(0),"m"]})]})]})]}):(0,t.jsx)("p",{className:"text-slate-400 font-medium mb-6 max-w-xs mx-auto",children:"Searching for GPS signal... Ensure location services are enabled."}),(0,t.jsx)("div",{className:"bg-slate-800 rounded-xl p-4 w-full mb-6 border border-slate-700",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 text-left",children:[(0,t.jsx)(j.AlertTriangle,{className:"text-amber-500 shrink-0",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-bold text-slate-300 uppercase",children:"Security Protocol"}),(0,t.jsx)("p",{className:"text-[10px] text-slate-500 mt-0.5",children:"Return to shop premises to auto-unlock."})]})]})}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 w-full",children:[(0,t.jsxs)("button",{onClick:y,className:"w-full py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-black uppercase tracking-widest text-xs flex items-center justify-center gap-2 active:scale-95 transition-all",children:[m?(0,t.jsx)(p.RefreshCw,{className:"animate-spin w-4 h-4"}):(0,t.jsx)(k.MapPin,{className:"w-4 h-4"}),"Check Location"]}),(0,t.jsxs)("a",{href:"tel:+233200000000",className:"w-full py-4 bg-slate-800 text-slate-400 hover:text-white rounded-xl font-bold uppercase tracking-widest text-xs flex items-center justify-center gap-2",children:[(0,t.jsx)(N.Phone,{className:"w-4 h-4"})," Call Manager"]})]}),(0,t.jsxs)("p",{className:"mt-8 text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:["Session ID: ",b?.user?.email]})]}):null}var I=e.i(60253);let P=(0,u.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var C=e.i(10129);function A(){let[e,a]=(0,n.useState)(null),[s,l]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(window.matchMedia("(display-mode: standalone)").matches)return;let e=localStorage.getItem("pwa-install-dismissed");if(e){let t=parseInt(e,10);if((Date.now()-t)/864e5<7)return}let t=e=>{e.preventDefault(),a(e),setTimeout(()=>l(!0),5e3)};return window.addEventListener("beforeinstallprompt",t),()=>window.removeEventListener("beforeinstallprompt",t)},[]);let r=async()=>{if(!e)return;e.prompt();let{outcome:t}=await e.userChoice;"accepted"===t&&console.log("âœ… PWA installed"),a(null),l(!1)};return s&&e?(0,t.jsx)("div",{className:"fixed bottom-20 left-4 right-4 z-50 animate-in slide-in-from-bottom-4 duration-300",children:(0,t.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl shadow-2xl p-4 text-white",children:[(0,t.jsx)("button",{onClick:()=>{localStorage.setItem("pwa-install-dismissed",Date.now().toString()),l(!1)},className:"absolute top-2 right-2 p-1 hover:bg-white/20 rounded-full transition-colors",children:(0,t.jsx)(I.X,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(C.Smartphone,{className:"w-6 h-6"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-black text-sm mb-1",children:"Install Nexus POS"}),(0,t.jsx)("p",{className:"text-xs text-blue-100 mb-3",children:"Add to home screen for instant access & offline mode"}),(0,t.jsxs)("button",{onClick:r,className:"w-full bg-white text-blue-600 font-bold text-sm py-2.5 px-4 rounded-xl hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 shadow-lg",children:[(0,t.jsx)(P,{className:"w-4 h-4"}),"Install App"]})]})]})]})}):null}var E=e.i(83428),L=e.i(3214),D=e.i(73750),O=e.i(93192),$=e.i(48109);let z=(0,u.default)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);async function T(){if(!navigator.storage||!navigator.storage.persist)return!1;let e=await navigator.storage.persist();return console.log(`ðŸ’¾ Persistent storage: ${e?"granted":"denied"}`),e}function R({children:e}){let s=(0,a.useRouter)(),r=(0,a.usePathname)(),{themeClasses:i}=(0,l.useMobileTheme)(),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(null);return((0,n.useEffect)(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("âœ… Service Worker registered:",e.scope),setInterval(()=>{e.update()},6e4)}).catch(e=>{console.error("âŒ Service Worker registration failed:",e)})}),T()},[]),null===o)?(0,t.jsx)("div",{className:"h-screen w-full flex items-center justify-center bg-slate-900",children:(0,t.jsx)(E.Loader2,{className:"animate-spin text-blue-500"})}):o.active?(0,t.jsx)(v,{returnDate:o.returnDate}):(0,t.jsxs)("div",{className:"w-full max-w-[480px] h-screen relative flex flex-col overflow-hidden transition-all duration-500 bg-slate-50 dark:bg-slate-900 mx-auto shadow-2xl rounded-xl border border-slate-200 dark:border-slate-800 overscroll-none select-none",children:[(0,t.jsx)("div",{className:"h-2 w-full bg-transparent z-50 shrink-0"}),d&&(0,t.jsx)(M,{shopLat:d.lat,shopLng:d.lng,radius:d.radius,bypass:d.bypass}),(0,t.jsxs)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar pb-32",children:[(0,t.jsx)(x,{}),e]}),(0,t.jsxs)("div",{className:"absolute bottom-6 left-4 right-4 h-20 rounded-3xl bg-[var(--glass-bg)] border border-[var(--glass-border)] shadow-[var(--glass-shadow)] backdrop-blur-xl flex justify-between items-center px-6 z-50",children:[(0,t.jsxs)("button",{onClick:()=>s.push("/mobilepos"),className:"group flex flex-col items-center gap-1 transition-all",children:[(0,t.jsx)("div",{className:`p-2 rounded-full transition-all duration-300 ${"/mobilepos"===r?"bg-blue-100 text-blue-600 translate-y-[-4px]":"text-slate-400"}`,children:(0,t.jsx)(D.Home,{size:22,className:"/mobilepos"===r?"fill-blue-600":""})}),"/mobilepos"===r&&(0,t.jsx)("span",{className:"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in"})]}),(0,t.jsxs)("button",{onClick:()=>s.push("/mobilepos/inventory"),className:"group flex flex-col items-center gap-1 transition-all",children:[(0,t.jsx)("div",{className:`p-2 rounded-full transition-all duration-300 ${"/mobilepos/inventory"===r?"bg-blue-100 text-blue-600 translate-y-[-4px]":"text-slate-400"}`,children:(0,t.jsx)(O.Package,{size:22,className:"/mobilepos/inventory"===r?"fill-blue-600":""})}),"/mobilepos/inventory"===r&&(0,t.jsx)("span",{className:"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in"})]}),(0,t.jsx)("div",{className:"relative -top-8",children:(0,t.jsx)("button",{onClick:()=>s.push("/mobilepos/pos"),className:"w-16 h-16 rounded-full flex items-center justify-center bg-[var(--nexus-primary)] text-white shadow-2xl shadow-blue-900/30 active:scale-90 transition-all border-[4px] border-white dark:border-slate-800",children:(0,t.jsx)(L.Plus,{size:28,strokeWidth:3})})}),(0,t.jsxs)("button",{onClick:()=>s.push("/mobilepos/messages"),className:"group flex flex-col items-center gap-1 transition-all",children:[(0,t.jsx)("div",{className:`p-2 rounded-full transition-all duration-300 ${"/mobilepos/messages"===r?"bg-blue-100 text-blue-600 translate-y-[-4px]":"text-slate-400"}`,children:(0,t.jsx)($.MessageSquare,{size:22,className:"/mobilepos/messages"===r?"fill-blue-600":""})}),"/mobilepos/messages"===r&&(0,t.jsx)("span",{className:"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in"})]}),(0,t.jsxs)("button",{onClick:()=>s.push("/mobilepos/settings"),className:"group flex flex-col items-center gap-1 transition-all",children:[(0,t.jsx)("div",{className:`p-2 rounded-full transition-all duration-300 ${"/mobilepos/settings"===r?"bg-blue-100 text-blue-600 translate-y-[-4px]":"text-slate-400"}`,children:(0,t.jsx)(z,{size:22})}),"/mobilepos/settings"===r&&(0,t.jsx)("span",{className:"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in"})]})]})]})}function _({children:e}){return(0,t.jsx)(s.SessionProvider,{children:(0,t.jsx)(l.MobileThemeProvider,{children:(0,t.jsx)(r.MobileDataProvider,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-950 flex justify-center items-center overflow-hidden font-sans antialiased selection:bg-blue-100",children:[(0,t.jsx)(o,{children:(0,t.jsx)(R,{children:e})}),(0,t.jsx)(A,{})]})})})})}e.s(["default",()=>_],65605)}]);