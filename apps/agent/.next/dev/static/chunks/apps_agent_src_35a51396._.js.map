{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/context/MobileThemeContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\n\ntype AccentColor = \"blue\" | \"purple\" | \"rose\" | \"amber\";\n\ninterface ThemeContextType {\n  darkMode: boolean;\n  toggleDarkMode: () => void;\n  accent: AccentColor;\n  setAccent: (color: AccentColor) => void;\n  themeClasses: {\n    bg: string;\n    text: string;\n    card: string;\n    border: string;\n    nav: string;\n  };\n}\n\nconst MobileThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function MobileThemeProvider({ children }: { children: React.ReactNode }) {\n  // Load from local storage or default to dark (it looks cooler)\n  const [darkMode, setDarkMode] = useState(true);\n  const [accent, setAccent] = useState<AccentColor>(\"blue\");\n\n  // Hydrate from storage on mount\n  useEffect(() => {\n    const savedMode = localStorage.getItem(\"nexus-theme-mode\");\n    const savedAccent = localStorage.getItem(\"nexus-theme-accent\");\n    if (savedMode) setDarkMode(savedMode === \"dark\");\n    if (savedAccent) setAccent(savedAccent as AccentColor);\n  }, []);\n\n  // Save changes\n  useEffect(() => {\n    localStorage.setItem(\"nexus-theme-mode\", darkMode ? \"dark\" : \"light\");\n    localStorage.setItem(\"nexus-theme-accent\", accent);\n  }, [darkMode, accent]);\n\n  const toggleDarkMode = () => setDarkMode(!darkMode);\n\n  // Dynamic Class Generator\n  const themeClasses = {\n    bg: darkMode ? \"bg-slate-900\" : \"bg-slate-50\",\n    text: darkMode ? \"text-white\" : \"text-slate-900\",\n    card: darkMode ? \"bg-slate-800\" : \"bg-white\",\n    border: darkMode ? \"border-slate-700\" : \"border-slate-100\",\n    nav: darkMode ? \"bg-slate-900/80 backdrop-blur-md\" : \"bg-white/80 backdrop-blur-md\"\n  };\n\n  return (\n    <MobileThemeContext.Provider value={{ darkMode, toggleDarkMode, accent, setAccent, themeClasses }}>\n      {children}\n    </MobileThemeContext.Provider>\n  );\n}\n\nexport function useMobileTheme() {\n  const context = useContext(MobileThemeContext);\n  if (!context) {\n    throw new Error(\"useMobileTheme must be used within a MobileThemeProvider\");\n  }\n  return context;\n}"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAoBA,MAAM,mCAAqB,IAAA,6SAAa,EAA+B;AAEhE,SAAS,oBAAoB,EAAE,QAAQ,EAAiC;;IAC7E,+DAA+D;IAC/D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,wSAAQ,EAAC;IACzC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,wSAAQ,EAAc;IAElD,gCAAgC;IAChC,IAAA,ySAAS;yCAAC;YACR,MAAM,YAAY,aAAa,OAAO,CAAC;YACvC,MAAM,cAAc,aAAa,OAAO,CAAC;YACzC,IAAI,WAAW,YAAY,cAAc;YACzC,IAAI,aAAa,UAAU;QAC7B;wCAAG,EAAE;IAEL,eAAe;IACf,IAAA,ySAAS;yCAAC;YACR,aAAa,OAAO,CAAC,oBAAoB,WAAW,SAAS;YAC7D,aAAa,OAAO,CAAC,sBAAsB;QAC7C;wCAAG;QAAC;QAAU;KAAO;IAErB,MAAM,iBAAiB,IAAM,YAAY,CAAC;IAE1C,0BAA0B;IAC1B,MAAM,eAAe;QACnB,IAAI,WAAW,iBAAiB;QAChC,MAAM,WAAW,eAAe;QAChC,MAAM,WAAW,iBAAiB;QAClC,QAAQ,WAAW,qBAAqB;QACxC,KAAK,WAAW,qCAAqC;IACvD;IAEA,qBACE,4TAAC,mBAAmB,QAAQ;QAAC,OAAO;YAAE;YAAU;YAAgB;YAAQ;YAAW;QAAa;kBAC7F;;;;;;AAGP;GAnCgB;KAAA;AAqCT,SAAS;;IACd,MAAM,UAAU,IAAA,0SAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/context/MobileDataContext.tsx"],"sourcesContent":["\"use client\";\n\n/**\n * üöÄ MOBILE DATA CONTEXT - HIGH PERFORMANCE\n * Centralized state management for mobile POS\n * Features:\n * - Smart caching with localStorage\n * - Background sync\n * - Optimistic updates\n * - Auto-refresh on shop reassignment\n */\n\nimport React, { createContext, useContext, useState, useEffect, useCallback, useRef } from \"react\";\nimport { toast } from \"react-hot-toast\";\n\ninterface MobileIdentity {\n  id: string;\n  agentName: string;\n  agentImage?: string;\n  shopId: string;\n  shopName: string;\n  managerName?: string;\n  managerPhone?: string;\n  // GPS Coordinates for geofencing\n  shopLat?: number;\n  shopLng?: number;\n  radius?: number;\n  targetProgress?: {\n    targetValue: number;\n    targetQuantity: number;\n    achievedValue: number;\n    achievedQuantity: number;\n  } | null;\n  bypassGeofence?: boolean;\n  lockout?: { active: boolean; returnDate?: string };\n}\n\ninterface InventoryItem {\n  id: string;\n  productName: string;\n  sku?: string;\n  quantity: number;\n  priceGHS: number;\n  stockLevel: number;\n  category?: string;\n}\n\ninterface MobileDataContextType {\n  identity: MobileIdentity | null;\n  inventory: InventoryItem[];\n  loading: boolean;\n  error: string | null;\n  refreshData: () => Promise<void>;\n  refreshInventory: () => Promise<void>;\n  updateInventoryItem: (id: string, updates: Partial<InventoryItem>) => void;\n  lastSync: Date | null;\n}\n\nconst MobileDataContext = createContext<MobileDataContextType | undefined>(undefined);\n\nconst CACHE_KEYS = {\n  IDENTITY: 'nexus_mobile_identity',\n  INVENTORY: 'nexus_mobile_inventory',\n  LAST_SYNC: 'nexus_mobile_last_sync'\n};\n\n// üöÄ OPTIMIZED: Tiered cache strategy\nconst CACHE_DURATION = {\n  IDENTITY: 30 * 60 * 1000,    // 30 minutes (rarely changes)\n  INVENTORY: 5 * 60 * 1000,    // 5 minutes (changes occasionally)\n  GPS: 24 * 60 * 60 * 1000     // 24 hours (static)\n};\n\n// üöÄ OPTIMIZED: Smart sync intervals based on visibility\nconst SYNC_INTERVAL = {\n  ACTIVE: 120 * 1000,       //  minutes when tab active  \n  BACKGROUND: 600 * 1000   // 10 minutes when tab hidden\n};\n\n// Request deduplication cache\nconst activeRequests = new Map<string, Promise<any>>();\n\nexport function MobileDataProvider({ children }: { children: React.ReactNode }) {\n  const [identity, setIdentity] = useState<MobileIdentity | null>(null);\n  const [inventory, setInventory] = useState<InventoryItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [lastSync, setLastSync] = useState<Date | null>(null);\n  const [currentShopId, setCurrentShopId] = useState<string | null>(null);\n  const syncIntervalRef = useRef<NodeJS.Timeout | undefined>(undefined);\n  const previousShopIdRef = useRef<string | null>(null);\n  const identityRef = useRef<MobileIdentity | null>(null);\n  const lastShopIdRef = useRef<string | null>(null);\n\n  // Keep refs in sync with state and update currentShopId only when value changes\n  useEffect(() => {\n    identityRef.current = identity;\n    const newShopId = identity?.shopId || null;\n    \n    // Only update currentShopId state if the actual value changed\n    // Use ref to track last value to avoid circular dependency\n    if (newShopId !== lastShopIdRef.current) {\n      lastShopIdRef.current = newShopId;\n      setCurrentShopId(newShopId);\n    }\n  }, [identity]); // Only depend on identity, not currentShopId\n\n  // üì¶ OPTIMIZED: Load from cache with tiered TTL\n  const loadFromCache = useCallback(() => {\n    try {\n      const cachedIdentity = localStorage.getItem(CACHE_KEYS.IDENTITY);\n      const cachedInventory = localStorage.getItem(CACHE_KEYS.INVENTORY);\n      const cachedSync = localStorage.getItem(CACHE_KEYS.LAST_SYNC);\n\n      if (cachedIdentity && cachedInventory && cachedSync) {\n        const syncTime = new Date(cachedSync);\n        const age = Date.now() - syncTime.getTime();\n\n        // Use inventory cache duration (5 minutes)\n        if (age < CACHE_DURATION.INVENTORY) {\n          const parsedIdentity = JSON.parse(cachedIdentity);\n          const parsedInventory = JSON.parse(cachedInventory);\n          \n          setIdentity(parsedIdentity);\n          setInventory(parsedInventory);\n          setLastSync(syncTime);\n          \n          console.log(`‚úÖ Cache loaded (age: ${Math.round(age/1000)}s)`);\n          return true;\n        } else {\n          console.log(`‚è∞ Cache expired (age: ${Math.round(age/1000)}s, max: ${CACHE_DURATION.INVENTORY/1000}s)`);\n        }\n      }\n    } catch (e) {\n      console.error('Cache load failed:', e);\n    }\n    return false;\n  }, []);\n\n  // üíæ SAVE TO CACHE\n  const saveToCache = useCallback((identityData: MobileIdentity, inventoryData: InventoryItem[]) => {\n    try {\n      const now = new Date();\n      localStorage.setItem(CACHE_KEYS.IDENTITY, JSON.stringify(identityData));\n      localStorage.setItem(CACHE_KEYS.INVENTORY, JSON.stringify(inventoryData));\n      localStorage.setItem(CACHE_KEYS.LAST_SYNC, now.toISOString());\n      setLastSync(now);\n    } catch (e) {\n      console.error('Cache save failed:', e);\n    }\n  }, []);\n\n  // üîÑ OPTIMIZED: Refresh inventory with request deduplication\n  const refreshInventory = useCallback(async () => {\n    const currentIdentity = identityRef.current;\n    if (!currentIdentity?.shopId) return;\n\n    const cacheKey = `inventory-${currentIdentity.shopId}`;\n    \n    // Check if request already in flight\n    if (activeRequests.has(cacheKey)) {\n      console.log('‚è© Deduplicating inventory request');\n      return activeRequests.get(cacheKey);\n    }\n\n    try {\n      const requestPromise = fetch(`/api/inventory?shopId=${currentIdentity.shopId}&t=${Date.now()}`)\n        .then(res => {\n          if (res.ok) {\n            return res.json();\n          }\n          throw new Error(`HTTP ${res.status}`);\n        })\n        .then(data => {\n          const items = Array.isArray(data) ? data : (data.data || []);\n          setInventory(items);\n          \n          // Update cache\n          if (identityRef.current) {\n            saveToCache(identityRef.current, items);\n          }\n          return items;\n        })\n        .finally(() => {\n          activeRequests.delete(cacheKey);\n        });\n      \n      activeRequests.set(cacheKey, requestPromise);\n      await requestPromise;\n    } catch (e: any) {\n      console.warn('‚ö†Ô∏è Background inventory sync failed:', e.message);\n      // Don't set error state for background sync failures\n    }\n  }, [saveToCache]);\n\n  // üîÑ FULL DATA REFRESH WITH REQUEST DEDUPLICATION\n  const refreshData = useCallback(async (showLoader = false) => {\n    if (showLoader) setLoading(true);\n    setError(null);\n\n    const cacheKey = 'mobile-init';\n    \n    // Check if request already in flight\n    if (activeRequests.has(cacheKey)) {\n      console.log('‚è© Deduplicating init request');\n      return activeRequests.get(cacheKey);\n    }\n\n    try {\n      // Parallel fetch for speed\n      console.log('üì° Mobile Init: Fetching assignment data...');\n      \n      const requestPromise = (async () => {\n        const initRes = await fetch(`/api/mobile/init?t=${Date.now()}`, { credentials: 'include' });\n        \n        if (!initRes.ok) {\n          if (initRes.status === 401) {\n            console.error('‚ùå Mobile Init: Authentication failed');\n            throw new Error('AUTH_FAILED');\n          }\n          if (initRes.status === 409) {\n            // User is not assigned to a shop\n            console.error('‚ùå Mobile Init: No shop assignment');\n            setError('NO_SHOP_ASSIGNED');\n            toast.error('No shop assigned. Contact your manager.', { duration: 5000 });\n            setLoading(false);\n            return;\n          }\n          console.error(`‚ùå Mobile Init: Failed with status ${initRes.status}`);\n          throw new Error('Init failed');\n        }\n\n        const initData = await initRes.json();\n        console.log('‚úÖ Mobile Init: Assignment data received', {\n          shopId: initData.shopId,\n          shopName: initData.shopName,\n          hasGPS: !!(initData.shopLat && initData.shopLng)\n        });\n\n        if (!initData.shopId) {\n          console.error('‚ùå Mobile Init: Response missing shopId');\n          setError('NO_SHOP_ASSIGNED');\n          toast.error('Invalid shop assignment. Please contact support.', { duration: 5000 });\n          setLoading(false);\n          return;\n        }\n\n        const identityData: MobileIdentity = {\n          id: initData.id,\n          agentName: initData.agentName,\n          agentImage: initData.agentImage,\n          shopId: initData.shopId,\n          shopName: initData.shopName,\n          managerName: initData.managerName,\n          managerPhone: initData.managerPhone,\n          // GPS data for geofencing\n          shopLat: initData.shopLat,\n          shopLng: initData.shopLng,\n          radius: initData.radius || 100,\n          targetProgress: initData.targetProgress,\n          bypassGeofence: initData.bypassGeofence,\n          lockout: initData.lockout\n        };\n\n        // Check if shop changed (reassignment)\n        if (previousShopIdRef.current && previousShopIdRef.current !== initData.shopId) {\n          console.log(`üîÑ Shop Reassignment Detected: ${previousShopIdRef.current} ‚Üí ${initData.shopId}`);\n          toast.success(`üîÑ Reassigned to ${initData.shopName}`, { duration: 3000 });\n          // Clear old inventory immediately\n          setInventory([]);\n        }\n        previousShopIdRef.current = initData.shopId;\n\n        setIdentity(identityData);\n\n        // Fetch inventory\n        console.log(`üì¶ Fetching inventory for shop: ${initData.shopId}`);\n        const invRes = await fetch(`/api/inventory?shopId=${initData.shopId}&t=${Date.now()}`);\n        \n        if (invRes.ok) {\n          const invData = await invRes.json();\n          const items = Array.isArray(invData) ? invData : (invData.data || []);\n          \n          console.log(`‚úÖ Inventory loaded: ${items.length} items`);\n          setInventory(items);\n          saveToCache(identityData, items);\n        } else {\n          console.warn('‚ö†Ô∏è Inventory fetch failed:', invRes.status);\n          // Set inventory to empty array but don't fail the whole sync\n          setInventory([]);\n          saveToCache(identityData, []);\n        }\n      })().finally(() => {\n        activeRequests.delete(cacheKey);\n        setLoading(false);\n      });\n\n      activeRequests.set(cacheKey, requestPromise);\n      await requestPromise;\n\n    } catch (e: any) {\n      console.error('‚ùå Mobile Data Sync Error:', e);\n      \n      // Better error messaging\n      let errorMessage = 'Connection error';\n      if (e.message === 'AUTH_FAILED') {\n        errorMessage = 'AUTH_FAILED';\n        toast.error('Session expired. Please login again.', { duration: 5000 });\n      } else if (e.message?.includes('fetch') || e.message?.includes('Failed to fetch')) {\n        errorMessage = 'Network connection lost. Please check your internet.';\n        toast.error('Network error. Retrying...', { duration: 3000 });\n      } else if (e.message?.includes('timeout')) {\n        errorMessage = 'Request timeout. Slow connection detected.';\n        toast.error('Connection timeout. Please try again.', { duration: 3000 });\n      } else {\n        toast.error('Sync failed. Pull to refresh.', { duration: 3000 });\n      }\n      \n      setError(errorMessage);\n      setLoading(false);\n    }\n  }, [saveToCache]);\n\n  // üéØ OPTIMISTIC UPDATE\n  const updateInventoryItem = useCallback((id: string, updates: Partial<InventoryItem>) => {\n    setInventory(prev => prev.map(item => \n      item.id === id ? { ...item, ...updates } : item\n    ));\n  }, []);\n\n  // üöÄ INITIAL LOAD WITH VISIBILITY-BASED SYNC\n  useEffect(() => {\n    let isMounted = true;\n    \n    // Try cache first for instant load\n    const hasCachedData = loadFromCache();\n    \n    if (hasCachedData) {\n      setLoading(false);\n      // Still refresh in background\n      if (isMounted) {\n        refreshData(false);\n      }\n    } else {\n      if (isMounted) {\n        refreshData(true);\n      }\n    }\n\n    return () => {\n      isMounted = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // Only run on mount\n\n  // üéØ SEPARATE EFFECT: Smart sync based on page visibility\n  useEffect(() => {\n    if (!currentShopId) return; // Wait for shopId to be loaded\n\n    let currentInterval = SYNC_INTERVAL.ACTIVE;\n    let syncIntervalId: NodeJS.Timeout;\n\n    const startSync = () => {\n      if (syncIntervalId) clearInterval(syncIntervalId);\n      syncIntervalId = setInterval(() => {\n        if (identityRef.current?.shopId === currentShopId) {\n          refreshInventory();\n        }\n      }, currentInterval);\n    };\n\n    // Handle visibility changes\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        // Tab hidden - slow down sync\n        console.log('üì¥ Tab hidden - reducing sync frequency');\n        currentInterval = SYNC_INTERVAL.BACKGROUND;\n      } else {\n        // Tab visible - speed up sync\n        console.log('üì± Tab active - increasing sync frequency');\n        currentInterval = SYNC_INTERVAL.ACTIVE;\n        // Immediate sync on resume\n        if (identityRef.current?.shopId === currentShopId) {\n          refreshInventory();\n        }\n      }\n      startSync();\n    };\n\n    // Listen for visibility changes\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    \n    // Start initial sync after a short delay to avoid immediate re-fetch\n    const timeoutId = setTimeout(() => {\n      startSync();\n    }, 5000); // Wait 5 seconds before starting periodic sync\n\n    return () => {\n      clearTimeout(timeoutId);\n      if (syncIntervalId) {\n        clearInterval(syncIntervalId);\n      }\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentShopId]); // Only re-run when the shopId string value actually changes\n\n  const value: MobileDataContextType = {\n    identity,\n    inventory,\n    loading,\n    error,\n    refreshData,\n    refreshInventory,\n    updateInventoryItem,\n    lastSync\n  };\n\n  return (\n    <MobileDataContext.Provider value={value}>\n      {children}\n    </MobileDataContext.Provider>\n  );\n}\n\nexport function useMobileData() {\n  const context = useContext(MobileDataContext);\n  if (context === undefined) {\n    throw new Error('useMobileData must be used within MobileDataProvider');\n  }\n  return context;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 510, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/components/auth/LocationGuard.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useRef } from \"react\";\nimport { toast } from \"react-hot-toast\"; // üîî Import Toast\nimport { useSession } from \"next-auth/react\";\n\nexport default function LocationGuard({ children }: { children: React.ReactNode }) {\n  const lastPulse = useRef<number>(0);\n  const { status } = useSession();\n\n  useEffect(() => {\n    // üõë STOP: If not logged in, don't track.\n    if (status !== \"authenticated\") return;\n\n    if (typeof window === 'undefined' || !navigator.geolocation) return;\n\n    // Security Check\n    const isSecure = window.isSecureContext || window.location.hostname === 'localhost';\n    if (!isSecure) {\n      console.warn(\"GPS Insecure Context\");\n      return;\n    }\n\n    const sendPulse = async (lat: number, lng: number, accuracy?: number) => {\n      const now = Date.now();\n      // Throttle: Send once every 30 seconds (Optimized)\n      if (now - lastPulse.current < 30000) return;\n\n      try {\n        const res = await fetch('/api/mobile/pulse', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include', // üç™ Include auth cookies\n          body: JSON.stringify({ lat, lng, accuracy })\n        });\n\n        if (res.ok) {\n          // ‚úÖ SUCCESS: Update Ref\n          lastPulse.current = now;\n        } else {\n          // ‚ùå FAILURE: Usually 401 Unauthorized\n          // Silent fail - don't spam console\n        }\n      } catch (e) {\n        // Silent fail\n      }\n    };\n\n    const watcher = navigator.geolocation.watchPosition(\n      (pos) => {\n        // Save to storage\n        sessionStorage.setItem('nexus_gps_lat', pos.coords.latitude.toString());\n        sessionStorage.setItem('nexus_gps_lng', pos.coords.longitude.toString());\n        if (pos.coords.accuracy !== undefined) {\n          sessionStorage.setItem('nexus_gps_accuracy', pos.coords.accuracy.toString());\n        }\n\n        // üî• FIRE PULSE with accuracy data\n        sendPulse(pos.coords.latitude, pos.coords.longitude, pos.coords.accuracy);\n      },\n      (err) => console.warn(err.message),\n      { enableHighAccuracy: true, maximumAge: 0, timeout: 20000 }\n    );\n\n    return () => navigator.geolocation.clearWatch(watcher);\n  }, [status]); // Re-run when status changes\n\n  return <>{children}</>;\n}"],"names":[],"mappings":";;;;;AACA;AAEA;;;AAHA;;;AAKe,SAAS,cAAc,EAAE,QAAQ,EAAiC;;IAC/E,MAAM,YAAY,IAAA,sSAAM,EAAS;IACjC,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,6YAAU;IAE7B,IAAA,ySAAS;mCAAC;YACR,0CAA0C;YAC1C,IAAI,WAAW,iBAAiB;YAEhC,IAAI,+CAAkB,eAAe,CAAC,UAAU,WAAW,EAAE;YAE7D,iBAAiB;YACjB,MAAM,WAAW,OAAO,eAAe,IAAI,OAAO,QAAQ,CAAC,QAAQ,KAAK;YACxE,IAAI,CAAC,UAAU;gBACb,QAAQ,IAAI,CAAC;gBACb;YACF;YAEA,MAAM;qDAAY,OAAO,KAAa,KAAa;oBACjD,MAAM,MAAM,KAAK,GAAG;oBACpB,mDAAmD;oBACnD,IAAI,MAAM,UAAU,OAAO,GAAG,OAAO;oBAErC,IAAI;wBACF,MAAM,MAAM,MAAM,MAAM,qBAAqB;4BAC3C,QAAQ;4BACR,SAAS;gCAAE,gBAAgB;4BAAmB;4BAC9C,aAAa;4BACb,MAAM,KAAK,SAAS,CAAC;gCAAE;gCAAK;gCAAK;4BAAS;wBAC5C;wBAEA,IAAI,IAAI,EAAE,EAAE;4BACV,wBAAwB;4BACxB,UAAU,OAAO,GAAG;wBACtB,OAAO;wBACL,sCAAsC;wBACtC,mCAAmC;wBACrC;oBACF,EAAE,OAAO,GAAG;oBACV,cAAc;oBAChB;gBACF;;YAEA,MAAM,UAAU,UAAU,WAAW,CAAC,aAAa;mDACjD,CAAC;oBACC,kBAAkB;oBAClB,eAAe,OAAO,CAAC,iBAAiB,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ;oBACpE,eAAe,OAAO,CAAC,iBAAiB,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ;oBACrE,IAAI,IAAI,MAAM,CAAC,QAAQ,KAAK,WAAW;wBACrC,eAAe,OAAO,CAAC,sBAAsB,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ;oBAC3E;oBAEA,mCAAmC;oBACnC,UAAU,IAAI,MAAM,CAAC,QAAQ,EAAE,IAAI,MAAM,CAAC,SAAS,EAAE,IAAI,MAAM,CAAC,QAAQ;gBAC1E;;mDACA,CAAC,MAAQ,QAAQ,IAAI,CAAC,IAAI,OAAO;kDACjC;gBAAE,oBAAoB;gBAAM,YAAY;gBAAG,SAAS;YAAM;YAG5D;2CAAO,IAAM,UAAU,WAAW,CAAC,UAAU,CAAC;;QAChD;kCAAG;QAAC;KAAO,GAAG,6BAA6B;IAE3C,qBAAO;kBAAG;;AACZ;GA9DwB;;QAEH,6YAAU;;;KAFP"}},
    {"offset": {"line": 611, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/lib/sync-queue.ts"],"sourcesContent":["\nexport interface SyncItem {\n    id: string;\n    type: 'REPORT' | 'LEAVE';\n    payload: any;\n    createdAt: number;\n}\n\nconst STORAGE_KEY = 'NEXUS_OFFLINE_QUEUE';\n\nexport const SyncQueue = {\n    enqueue: (type: 'REPORT' | 'LEAVE', payload: any) => {\n        if (typeof window === 'undefined') return;\n\n        const item: SyncItem = {\n            id: crypto.randomUUID(),\n            type,\n            payload,\n            createdAt: Date.now()\n        };\n\n        const queue = SyncQueue.getAll();\n        queue.push(item);\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(queue));\n        return item;\n    },\n\n    getAll: (): SyncItem[] => {\n        if (typeof window === 'undefined') return [];\n        try {\n            return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');\n        } catch {\n            return [];\n        }\n    },\n\n    remove: (id: string) => {\n        if (typeof window === 'undefined') return;\n        const queue = SyncQueue.getAll().filter(i => i.id !== id);\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(queue));\n    },\n\n    clear: () => {\n        if (typeof window === 'undefined') return;\n        localStorage.removeItem(STORAGE_KEY);\n    },\n\n    count: (): number => {\n        return SyncQueue.getAll().length;\n    }\n};\n"],"names":[],"mappings":";;;;AAQA,MAAM,cAAc;AAEb,MAAM,YAAY;IACrB,SAAS,CAAC,MAA0B;QAChC;;QAEA,MAAM,OAAiB;YACnB,IAAI,OAAO,UAAU;YACrB;YACA;YACA,WAAW,KAAK,GAAG;QACvB;QAEA,MAAM,QAAQ,UAAU,MAAM;QAC9B,MAAM,IAAI,CAAC;QACX,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACjD,OAAO;IACX;IAEA,QAAQ;QACJ;;QACA,IAAI;YACA,OAAO,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,gBAAgB;QAC3D,EAAE,OAAM;YACJ,OAAO,EAAE;QACb;IACJ;IAEA,QAAQ,CAAC;QACL;;QACA,MAAM,QAAQ,UAAU,MAAM,GAAG,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QACtD,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;IACrD;IAEA,OAAO;QACH;;QACA,aAAa,UAAU,CAAC;IAC5B;IAEA,OAAO;QACH,OAAO,UAAU,MAAM,GAAG,MAAM;IACpC;AACJ"}},
    {"offset": {"line": 662, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/components/mobile/SyncManager.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { toast } from \"react-hot-toast\";\nimport { SyncQueue, SyncItem } from \"@/lib/sync-queue\";\nimport { Wifi, WifiOff, RefreshCw } from \"lucide-react\";\n\nexport default function SyncManager() {\n    const [isOnline, setIsOnline] = useState(true);\n    const [isSyncing, setIsSyncing] = useState(false);\n    const [pendingCount, setPendingCount] = useState(0);\n\n    useEffect(() => {\n        // Initial check\n        setIsOnline(navigator.onLine);\n        setPendingCount(SyncQueue.count());\n\n        // Listeners\n        const handleOnline = () => { setIsOnline(true); processQueue(); };\n        const handleOffline = () => setIsOnline(false);\n\n        window.addEventListener('online', handleOnline);\n        window.addEventListener('offline', handleOffline);\n\n        // Periodic check\n        const interval = setInterval(() => {\n            setPendingCount(SyncQueue.count());\n            if (navigator.onLine && SyncQueue.count() > 0) processQueue();\n        }, 10000);\n\n        return () => {\n            window.removeEventListener('online', handleOnline);\n            window.removeEventListener('offline', handleOffline);\n            clearInterval(interval);\n        };\n    }, []);\n\n    const processQueue = async () => {\n        if (isSyncing || SyncQueue.count() === 0) return;\n        setIsSyncing(true);\n        const toastId = toast.loading(\"Syncing Offline Data...\");\n\n        const queue = SyncQueue.getAll();\n        let successCount = 0;\n\n        for (const item of queue) {\n            try {\n                let endpoint = '';\n                if (item.type === 'REPORT') endpoint = '/api/operations/reports';\n                if (item.type === 'LEAVE') endpoint = '/api/hr/leaves';\n\n                const res = await fetch(endpoint, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(item.payload)\n                });\n\n                if (res.ok) {\n                    SyncQueue.remove(item.id);\n                    successCount++;\n                }\n            } catch (e) {\n                console.error(\"Sync Failed for item\", item.id);\n            }\n        }\n\n        setIsSyncing(false);\n        setPendingCount(SyncQueue.count());\n\n        if (successCount > 0) {\n            toast.success(`Synced ${successCount} items`, { id: toastId });\n        } else {\n            toast.dismiss(toastId);\n        }\n    };\n\n    if (pendingCount === 0 && isOnline) return null;\n\n    return (\n        <div className=\"fixed bottom-20 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-4 py-2 bg-slate-900/90 backdrop-blur text-white rounded-full shadow-xl border border-white/10\">\n            {isOnline ? (\n                isSyncing ? <RefreshCw size={14} className=\"animate-spin text-blue-400\" /> : <Wifi size={14} className=\"text-emerald-400\" />\n            ) : (\n                <WifiOff size={14} className=\"text-rose-400\" />\n            )}\n\n            <span className=\"text-[10px] font-black uppercase tracking-widest\">\n                {isOnline ? (isSyncing ? \"Syncing...\" : `${pendingCount} Pending`) : \"Offline Mode\"}\n            </span>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;;;AALA;;;;;AAOe,SAAS;;IACpB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,wSAAQ,EAAC;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wSAAQ,EAAC;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,wSAAQ,EAAC;IAEjD,IAAA,ySAAS;iCAAC;YACN,gBAAgB;YAChB,YAAY,UAAU,MAAM;YAC5B,gBAAgB,4JAAS,CAAC,KAAK;YAE/B,YAAY;YACZ,MAAM;sDAAe;oBAAQ,YAAY;oBAAO;gBAAgB;;YAChE,MAAM;uDAAgB,IAAM,YAAY;;YAExC,OAAO,gBAAgB,CAAC,UAAU;YAClC,OAAO,gBAAgB,CAAC,WAAW;YAEnC,iBAAiB;YACjB,MAAM,WAAW;kDAAY;oBACzB,gBAAgB,4JAAS,CAAC,KAAK;oBAC/B,IAAI,UAAU,MAAM,IAAI,4JAAS,CAAC,KAAK,KAAK,GAAG;gBACnD;iDAAG;YAEH;yCAAO;oBACH,OAAO,mBAAmB,CAAC,UAAU;oBACrC,OAAO,mBAAmB,CAAC,WAAW;oBACtC,cAAc;gBAClB;;QACJ;gCAAG,EAAE;IAEL,MAAM,eAAe;QACjB,IAAI,aAAa,4JAAS,CAAC,KAAK,OAAO,GAAG;QAC1C,aAAa;QACb,MAAM,UAAU,kTAAK,CAAC,OAAO,CAAC;QAE9B,MAAM,QAAQ,4JAAS,CAAC,MAAM;QAC9B,IAAI,eAAe;QAEnB,KAAK,MAAM,QAAQ,MAAO;YACtB,IAAI;gBACA,IAAI,WAAW;gBACf,IAAI,KAAK,IAAI,KAAK,UAAU,WAAW;gBACvC,IAAI,KAAK,IAAI,KAAK,SAAS,WAAW;gBAEtC,MAAM,MAAM,MAAM,MAAM,UAAU;oBAC9B,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC,KAAK,OAAO;gBACrC;gBAEA,IAAI,IAAI,EAAE,EAAE;oBACR,4JAAS,CAAC,MAAM,CAAC,KAAK,EAAE;oBACxB;gBACJ;YACJ,EAAE,OAAO,GAAG;gBACR,QAAQ,KAAK,CAAC,wBAAwB,KAAK,EAAE;YACjD;QACJ;QAEA,aAAa;QACb,gBAAgB,4JAAS,CAAC,KAAK;QAE/B,IAAI,eAAe,GAAG;YAClB,kTAAK,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,aAAa,MAAM,CAAC,EAAE;gBAAE,IAAI;YAAQ;QAChE,OAAO;YACH,kTAAK,CAAC,OAAO,CAAC;QAClB;IACJ;IAEA,IAAI,iBAAiB,KAAK,UAAU,OAAO;IAE3C,qBACI,4TAAC;QAAI,WAAU;;YACV,WACG,0BAAY,4TAAC,oTAAS;gBAAC,MAAM;gBAAI,WAAU;;;;;qCAAkC,4TAAC,iSAAI;gBAAC,MAAM;gBAAI,WAAU;;;;;qCAEvG,4TAAC,8SAAO;gBAAC,MAAM;gBAAI,WAAU;;;;;;0BAGjC,4TAAC;gBAAK,WAAU;0BACX,WAAY,YAAY,eAAe,GAAG,aAAa,QAAQ,CAAC,GAAI;;;;;;;;;;;;AAIrF;GApFwB;KAAA"}},
    {"offset": {"line": 806, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/components/mobile/LeaveLockout.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { ShieldOff, Calendar, PhoneCall, LogOut } from \"lucide-react\";\nimport { signOut } from \"next-auth/react\";\n\nexport default function LeaveLockout({ returnDate }: { returnDate: string }) {\n  return (\n    <div className=\"min-h-screen bg-slate-900 flex flex-col items-center justify-center p-8 text-center text-white\">\n      <div className=\"w-20 h-20 bg-blue-600/20 rounded-full flex items-center justify-center mb-8 border border-blue-500/30\">\n        <ShieldOff className=\"w-10 h-10 text-blue-500\" />\n      </div>\n      \n      <h1 className=\"text-2xl font-black tracking-tighter uppercase mb-2\">System Locked</h1>\n      <p className=\"text-slate-400 text-sm uppercase font-bold tracking-widest mb-10 leading-relaxed\">\n        Your access to the Nexus Grid has been temporarily suspended due to approved leave.\n      </p>\n\n      <div className=\"w-full bg-white/5 border border-white/10 rounded-2xl p-6 mb-10\">\n        <div className=\"flex items-center justify-between mb-4 pb-4 border-b border-white/10\">\n          <span className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest\">Return Date</span>\n          <div className=\"flex items-center gap-2\">\n             <Calendar className=\"w-4 h-4 text-blue-500\" />\n             <span className=\"text-sm font-black tabular-nums\">{returnDate}</span>\n          </div>\n        </div>\n        <div className=\"text-left\">\n          <p className=\"text-[9px] text-slate-500 font-bold uppercase tracking-widest mb-2\">Instructions</p>\n          <p className=\"text-[11px] text-slate-300 leading-relaxed\">\n            Please contact your LG Regional Supervisor if you are returning to your node earlier than expected.\n          </p>\n        </div>\n      </div>\n\n      <div className=\"w-full space-y-4\">\n        <button className=\"w-full py-4 bg-white text-slate-900 rounded-xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-3\">\n          <PhoneCall className=\"w-4 h-4\" /> Contact Supervisor\n        </button>\n        <button \n          onClick={() => signOut()}\n          className=\"w-full py-4 bg-white/5 text-slate-400 rounded-xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-3 border border-white/10\"\n        >\n          <LogOut className=\"w-4 h-4\" /> Sign Out\n        </button>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAGA;AAAA;AAAA;AAAA;AACA;AAJA;;;;AAMe,SAAS,aAAa,EAAE,UAAU,EAA0B;IACzE,qBACE,4TAAC;QAAI,WAAU;;0BACb,4TAAC;gBAAI,WAAU;0BACb,cAAA,4TAAC,oTAAS;oBAAC,WAAU;;;;;;;;;;;0BAGvB,4TAAC;gBAAG,WAAU;0BAAsD;;;;;;0BACpE,4TAAC;gBAAE,WAAU;0BAAmF;;;;;;0BAIhG,4TAAC;gBAAI,WAAU;;kCACb,4TAAC;wBAAI,WAAU;;0CACb,4TAAC;gCAAK,WAAU;0CAAiE;;;;;;0CACjF,4TAAC;gCAAI,WAAU;;kDACZ,4TAAC,6SAAQ;wCAAC,WAAU;;;;;;kDACpB,4TAAC;wCAAK,WAAU;kDAAmC;;;;;;;;;;;;;;;;;;kCAGxD,4TAAC;wBAAI,WAAU;;0CACb,4TAAC;gCAAE,WAAU;0CAAqE;;;;;;0CAClF,4TAAC;gCAAE,WAAU;0CAA6C;;;;;;;;;;;;;;;;;;0BAM9D,4TAAC;gBAAI,WAAU;;kCACb,4TAAC;wBAAO,WAAU;;0CAChB,4TAAC,oTAAS;gCAAC,WAAU;;;;;;4BAAY;;;;;;;kCAEnC,4TAAC;wBACC,SAAS,IAAM,IAAA,0YAAO;wBACtB,WAAU;;0CAEV,4TAAC,2SAAM;gCAAC,WAAU;;;;;;4BAAY;;;;;;;;;;;;;;;;;;;AAKxC;KAzCwB"}},
    {"offset": {"line": 990, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * üåç STANDARDIZED HAVERSINE DISTANCE CALCULATOR\n * Calculates distance between two GPS coordinates in meters.\n * Uses the Haversine formula for great-circle distance.\n * \n * @param lat1 - Latitude of first point\n * @param lng1 - Longitude of first point\n * @param lat2 - Latitude of second point\n * @param lng2 - Longitude of second point\n * @returns Distance in meters (rounded to nearest integer)\n */\nexport const calculateDistance = (\n  lat1: number,\n  lng1: number,\n  lat2: number,\n  lng2: number\n): number => {\n  const R = 6371e3; // Earth's radius in meters\n  const toRad = (deg: number) => (deg * Math.PI) / 180;\n  \n  const dLat = toRad(lat2 - lat1);\n  const dLng = toRad(lng2 - lng1);\n  \n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(toRad(lat1)) *\n    Math.cos(toRad(lat2)) *\n    Math.sin(dLng / 2) * Math.sin(dLng / 2);\n    \n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  \n  return Math.round(R * c);\n};"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,uOAAO,EAAC,IAAA,iMAAI,EAAC;AACtB;AAaO,MAAM,oBAAoB,CAC/B,MACA,MACA,MACA;IAEA,MAAM,IAAI,QAAQ,2BAA2B;IAC7C,MAAM,QAAQ,CAAC,MAAgB,AAAC,MAAM,KAAK,EAAE,GAAI;IAEjD,MAAM,OAAO,MAAM,OAAO;IAC1B,MAAM,OAAO,MAAM,OAAO;IAE1B,MAAM,IACJ,KAAK,GAAG,CAAC,OAAO,KAAK,KAAK,GAAG,CAAC,OAAO,KACrC,KAAK,GAAG,CAAC,MAAM,SACf,KAAK,GAAG,CAAC,MAAM,SACf,KAAK,GAAG,CAAC,OAAO,KAAK,KAAK,GAAG,CAAC,OAAO;IAEvC,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI;IAErD,OAAO,KAAK,KAAK,CAAC,IAAI;AACxB"}},
    {"offset": {"line": 1019, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/components/mobile/GeoLockoutOverlay.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { Lock, MapPin, RefreshCw, AlertTriangle, Phone, Signal } from \"lucide-react\";\nimport { useSession } from \"next-auth/react\";\nimport { calculateDistance } from \"@/lib/utils\";\n\n/**\n * üîí GEO LOCKOUT OVERLAY - PRODUCTION GRADE\n * Blocks the entire screen if the user is outside their assigned zone.\n * Features:\n * - GPS accuracy validation\n * - Safety buffer to prevent false lockouts\n * - Multiple readings for consistency\n * - User-friendly accuracy display\n */\n\nconst GPS_ACCURACY_THRESHOLD = 50; // Only accept GPS readings with ‚â§50m accuracy\nconst SAFETY_BUFFER = 30; // Add 30m buffer to geofence to account for GPS inaccuracy\nconst CONSISTENCY_CHECKS = 2; // Must be outside zone this many times before locking\n\nexport default function GeoLockoutOverlay({\n    shopLat,\n    shopLng,\n    radius,\n    bypass\n}: {\n    shopLat: number;\n    shopLng: number;\n    radius: number;\n    bypass: boolean\n}) {\n    const [locked, setLocked] = useState(false);\n    const [distance, setDistance] = useState(0);\n    const [accuracy, setAccuracy] = useState<number | null>(null);\n    const [checking, setChecking] = useState(true);\n    const [outsideCount, setOutsideCount] = useState(0);\n    const { data: session } = useSession();\n\n    const checkLocation = () => {\n        setChecking(true);\n        if (!navigator.geolocation) {\n            setLocked(true);\n            setChecking(false);\n            return;\n        }\n\n        navigator.geolocation.getCurrentPosition(\n            (pos) => {\n                const userLat = pos.coords.latitude;\n                const userLng = pos.coords.longitude;\n                const gpsAccuracy = pos.coords.accuracy;\n                const dist = calculateDistance(userLat, userLng, shopLat, shopLng);\n\n                setDistance(dist);\n                setAccuracy(gpsAccuracy);\n\n                // üõ°Ô∏è PRODUCTION-SAFE LOGIC\n                // Only trust GPS if accuracy is good enough\n                if (gpsAccuracy > GPS_ACCURACY_THRESHOLD) {\n                    console.warn(`GPS accuracy too low: ${gpsAccuracy.toFixed(0)}m. Waiting for better signal...`);\n                    setChecking(false);\n                    return; // Don't lock/unlock on poor GPS\n                }\n\n                // Apply safety buffer to prevent false lockouts\n                const effectiveRadius = radius + SAFETY_BUFFER;\n                const isOutside = dist > effectiveRadius && !bypass;\n\n                // Check consistency before locking\n                if (isOutside) {\n                    setOutsideCount(prev => {\n                        const newCount = prev + 1;\n                        if (newCount >= CONSISTENCY_CHECKS) {\n                            setLocked(true);\n                        }\n                        return newCount;\n                    });\n                } else {\n                    // Inside zone - unlock immediately and reset count\n                    setLocked(false);\n                    setOutsideCount(0);\n                }\n\n                setChecking(false);\n            },\n            (err) => {\n                console.warn(\"GPS Error\", err);\n                // Don't immediately lock on GPS error - user might be indoors temporarily\n                setChecking(false);\n            },\n            { \n                enableHighAccuracy: true, \n                timeout: 15000, // Give GPS time to get accurate fix\n                maximumAge: 0 // Always get fresh reading\n            }\n        );\n    };\n\n    useEffect(() => {\n        checkLocation();\n        const interval = setInterval(checkLocation, 30000); // Re-check every 30s\n        return () => clearInterval(interval);\n    }, [shopLat, shopLng, radius, bypass]);\n\n    if (!locked && !checking) return null; // üü¢ Safe Zone\n\n    // If initial load, don't show full block immediately, maybe just null or loader\n    if (checking && !locked) return null;\n\n    return (\n        <div className=\"absolute inset-0 z-[9999] bg-slate-900/95 backdrop-blur-md flex flex-col items-center justify-center p-8 text-center animate-in fade-in duration-300\">\n\n            <div className=\"w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center mb-6 relative\">\n                <div className=\"absolute inset-0 bg-red-500/20 rounded-full animate-ping\" />\n                <Lock className=\"w-10 h-10 text-red-500 relative z-10\" />\n            </div>\n\n            <h2 className=\"text-2xl font-black text-white uppercase tracking-tight mb-2\">Terminal Locked</h2>\n\n            {distance > 0 ? (\n                <>\n                    <p className=\"text-slate-400 font-medium mb-2 max-w-xs mx-auto\">\n                        You are <span className=\"text-white font-bold\">{distance}m</span> away from the shop zone.\n                        Allowed radius is <span className=\"text-white font-bold\">{radius}m</span>.\n                    </p>\n                    {accuracy !== null && (\n                        <div className=\"flex items-center gap-2 text-xs mb-6\">\n                            <Signal className={`w-4 h-4 ${\n                                accuracy <= 20 ? 'text-green-400' : \n                                accuracy <= 50 ? 'text-yellow-400' : \n                                'text-red-400'\n                            }`} />\n                            <span className=\"text-slate-500\">\n                                GPS Accuracy: <span className={`font-bold ${\n                                    accuracy <= 20 ? 'text-green-400' : \n                                    accuracy <= 50 ? 'text-yellow-400' : \n                                    'text-red-400'\n                                }`}>¬±{accuracy.toFixed(0)}m</span>\n                            </span>\n                        </div>\n                    )}\n                </>\n            ) : (\n                <p className=\"text-slate-400 font-medium mb-6 max-w-xs mx-auto\">\n                    Searching for GPS signal... Ensure location services are enabled.\n                </p>\n            )}\n\n            <div className=\"bg-slate-800 rounded-xl p-4 w-full mb-6 border border-slate-700\">\n                <div className=\"flex items-center gap-3 text-left\">\n                    <AlertTriangle className=\"text-amber-500 shrink-0\" size={20} />\n                    <div>\n                        <p className=\"text-xs font-bold text-slate-300 uppercase\">Security Protocol</p>\n                        <p className=\"text-[10px] text-slate-500 mt-0.5\">Return to shop premises to auto-unlock.</p>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"flex flex-col gap-3 w-full\">\n                <button\n                    onClick={checkLocation}\n                    className=\"w-full py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-black uppercase tracking-widest text-xs flex items-center justify-center gap-2 active:scale-95 transition-all\"\n                >\n                    {checking ? <RefreshCw className=\"animate-spin w-4 h-4\" /> : <MapPin className=\"w-4 h-4\" />}\n                    Check Location\n                </button>\n\n                <a href=\"tel:+233200000000\" className=\"w-full py-4 bg-slate-800 text-slate-400 hover:text-white rounded-xl font-bold uppercase tracking-widest text-xs flex items-center justify-center gap-2\">\n                    <Phone className=\"w-4 h-4\" /> Call Manager\n                </a>\n            </div>\n\n            <p className=\"mt-8 text-[10px] font-bold text-slate-600 uppercase tracking-widest\">\n                Session ID: {session?.user?.email}\n            </p>\n\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1374, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/components/mobile/PWAInstallPrompt.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { X, Download, Smartphone } from \"lucide-react\";\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: \"accepted\" | \"dismissed\" }>;\n}\n\nexport function PWAInstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n\n  useEffect(() => {\n    // Check if already installed\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      return; // Already installed\n    }\n\n    // Check if user previously dismissed\n    const dismissed = localStorage.getItem('pwa-install-dismissed');\n    if (dismissed) {\n      const dismissedTime = parseInt(dismissed, 10);\n      const daysSince = (Date.now() - dismissedTime) / (1000 * 60 * 60 * 24);\n      if (daysSince < 7) return; // Don't show again for 7 days\n    }\n\n    // Listen for install prompt\n    const handler = (e: Event) => {\n      e.preventDefault();\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n      \n      // Show prompt after 5 seconds of usage\n      setTimeout(() => setShowPrompt(true), 5000);\n    };\n\n    window.addEventListener('beforeinstallprompt', handler);\n\n    return () => window.removeEventListener('beforeinstallprompt', handler);\n  }, []);\n\n  const handleInstall = async () => {\n    if (!deferredPrompt) return;\n\n    deferredPrompt.prompt();\n    const { outcome } = await deferredPrompt.userChoice;\n\n    if (outcome === 'accepted') {\n      console.log('‚úÖ PWA installed');\n    }\n\n    setDeferredPrompt(null);\n    setShowPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    localStorage.setItem('pwa-install-dismissed', Date.now().toString());\n    setShowPrompt(false);\n  };\n\n  if (!showPrompt || !deferredPrompt) return null;\n\n  return (\n    <div className=\"fixed bottom-20 left-4 right-4 z-50 animate-in slide-in-from-bottom-4 duration-300\">\n      <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl shadow-2xl p-4 text-white\">\n        <button\n          onClick={handleDismiss}\n          className=\"absolute top-2 right-2 p-1 hover:bg-white/20 rounded-full transition-colors\"\n        >\n          <X className=\"w-4 h-4\" />\n        </button>\n\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0\">\n            <Smartphone className=\"w-6 h-6\" />\n          </div>\n          \n          <div className=\"flex-1\">\n            <h3 className=\"font-black text-sm mb-1\">Install Nexus POS</h3>\n            <p className=\"text-xs text-blue-100 mb-3\">\n              Add to home screen for instant access & offline mode\n            </p>\n            \n            <button\n              onClick={handleInstall}\n              className=\"w-full bg-white text-blue-600 font-bold text-sm py-2.5 px-4 rounded-xl hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 shadow-lg\"\n            >\n              <Download className=\"w-4 h-4\" />\n              Install App\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;;;AAHA;;;AAUO,SAAS;;IACd,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,wSAAQ,EAAkC;IACtF,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,wSAAQ,EAAC;IAE7C,IAAA,ySAAS;sCAAC;YACR,6BAA6B;YAC7B,IAAI,OAAO,UAAU,CAAC,8BAA8B,OAAO,EAAE;gBAC3D,QAAQ,oBAAoB;YAC9B;YAEA,qCAAqC;YACrC,MAAM,YAAY,aAAa,OAAO,CAAC;YACvC,IAAI,WAAW;gBACb,MAAM,gBAAgB,SAAS,WAAW;gBAC1C,MAAM,YAAY,CAAC,KAAK,GAAG,KAAK,aAAa,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;gBACrE,IAAI,YAAY,GAAG,QAAQ,8BAA8B;YAC3D;YAEA,4BAA4B;YAC5B,MAAM;sDAAU,CAAC;oBACf,EAAE,cAAc;oBAChB,kBAAkB;oBAElB,uCAAuC;oBACvC;8DAAW,IAAM,cAAc;6DAAO;gBACxC;;YAEA,OAAO,gBAAgB,CAAC,uBAAuB;YAE/C;8CAAO,IAAM,OAAO,mBAAmB,CAAC,uBAAuB;;QACjE;qCAAG,EAAE;IAEL,MAAM,gBAAgB;QACpB,IAAI,CAAC,gBAAgB;QAErB,eAAe,MAAM;QACrB,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,eAAe,UAAU;QAEnD,IAAI,YAAY,YAAY;YAC1B,QAAQ,GAAG,CAAC;QACd;QAEA,kBAAkB;QAClB,cAAc;IAChB;IAEA,MAAM,gBAAgB;QACpB,aAAa,OAAO,CAAC,yBAAyB,KAAK,GAAG,GAAG,QAAQ;QACjE,cAAc;IAChB;IAEA,IAAI,CAAC,cAAc,CAAC,gBAAgB,OAAO;IAE3C,qBACE,4TAAC;QAAI,WAAU;kBACb,cAAA,4TAAC;YAAI,WAAU;;8BACb,4TAAC;oBACC,SAAS;oBACT,WAAU;8BAEV,cAAA,4TAAC,wRAAC;wBAAC,WAAU;;;;;;;;;;;8BAGf,4TAAC;oBAAI,WAAU;;sCACb,4TAAC;4BAAI,WAAU;sCACb,cAAA,4TAAC,mTAAU;gCAAC,WAAU;;;;;;;;;;;sCAGxB,4TAAC;4BAAI,WAAU;;8CACb,4TAAC;oCAAG,WAAU;8CAA0B;;;;;;8CACxC,4TAAC;oCAAE,WAAU;8CAA6B;;;;;;8CAI1C,4TAAC;oCACC,SAAS;oCACT,WAAU;;sDAEV,4TAAC,6SAAQ;4CAAC,WAAU;;;;;;wCAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ9C;GAtFgB;KAAA"}},
    {"offset": {"line": 1546, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/lib/pwa-register.ts"],"sourcesContent":["// Register Service Worker for PWA functionality\nexport function registerServiceWorker() {\n  if (typeof window === 'undefined') return;\n  if (!('serviceWorker' in navigator)) return;\n\n  window.addEventListener('load', () => {\n    navigator.serviceWorker\n      .register('/sw.js')\n      .then((registration) => {\n        console.log('‚úÖ Service Worker registered:', registration.scope);\n\n        // Check for updates every 60 seconds\n        setInterval(() => {\n          registration.update();\n        }, 60000);\n      })\n      .catch((error) => {\n        console.error('‚ùå Service Worker registration failed:', error);\n      });\n  });\n}\n\n// Request persistent storage for offline data\nexport async function requestPersistentStorage() {\n  if (typeof window === 'undefined') return false;\n  if (!navigator.storage || !navigator.storage.persist) return false;\n\n  const isPersisted = await navigator.storage.persist();\n  console.log(`üíæ Persistent storage: ${isPersisted ? 'granted' : 'denied'}`);\n  return isPersisted;\n}\n\n// Check if running as installed PWA\nexport function isInstalledPWA(): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.matchMedia('(display-mode: standalone)').matches ||\n         (window.navigator as any).standalone === true;\n}\n"],"names":[],"mappings":"AAAA,gDAAgD;;;;;;;;;AACzC,SAAS;IACd;;IACA,IAAI,CAAC,CAAC,mBAAmB,SAAS,GAAG;IAErC,OAAO,gBAAgB,CAAC,QAAQ;QAC9B,UAAU,aAAa,CACpB,QAAQ,CAAC,UACT,IAAI,CAAC,CAAC;YACL,QAAQ,GAAG,CAAC,gCAAgC,aAAa,KAAK;YAE9D,qCAAqC;YACrC,YAAY;gBACV,aAAa,MAAM;YACrB,GAAG;QACL,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,KAAK,CAAC,yCAAyC;QACzD;IACJ;AACF;AAGO,eAAe;IACpB;;IACA,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC,UAAU,OAAO,CAAC,OAAO,EAAE,OAAO;IAE7D,MAAM,cAAc,MAAM,UAAU,OAAO,CAAC,OAAO;IACnD,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,cAAc,YAAY,UAAU;IAC1E,OAAO;AACT;AAGO,SAAS;IACd;;IACA,OAAO,OAAO,UAAU,CAAC,8BAA8B,OAAO,IACvD,AAAC,OAAO,SAAS,CAAS,UAAU,KAAK;AAClD"}},
    {"offset": {"line": 1591, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/nexus-platform/apps/agent/src/app/mobilepos/layout.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useRouter, usePathname } from \"next/navigation\";\nimport { SessionProvider as AuthProvider } from \"@/components/providers/SessionProvider\";\nimport { MobileThemeProvider, useMobileTheme } from \"@/context/MobileThemeContext\";\nimport { MobileDataProvider } from \"@/context/MobileDataContext\";\nimport LocationGuard from \"@/components/auth/LocationGuard\";\nimport SyncManager from \"@/components/mobile/SyncManager\";\nimport LeaveLockout from \"@/components/mobile/LeaveLockout\";\nimport GeoLockoutOverlay from \"@/components/mobile/GeoLockoutOverlay\";\nimport { PWAInstallPrompt } from \"@/components/mobile/PWAInstallPrompt\";\nimport { useEffect, useState } from \"react\";\nimport { Loader2, Plus, Home, Package, MessageSquare, Menu } from \"lucide-react\";\nimport { registerServiceWorker, requestPersistentStorage } from \"@/lib/pwa-register\";\n\n/**\n * üì± MOBILE FRAME WRAPPER\n * High-End SaaS Overhaul + PWA Support\n */\nfunction MobileFrame({ children }: { children: React.ReactNode }) {\n  const router = useRouter();\n  const pathname = usePathname();\n  const { themeClasses } = useMobileTheme();\n  const [lockout, setLockout] = useState<{ active: boolean; returnDate?: string } | null>(null);\n  const [geoConfig, setGeoConfig] = useState<{ lat: number; lng: number; radius: number; bypass: boolean } | null>(null);\n\n  useEffect(() => {\n    // üöÄ Register PWA service worker\n    registerServiceWorker();\n    requestPersistentStorage();\n\n    // Note: Init data now comes from MobileDataContext\n    // We just need to setup geo config from the context\n  }, []);\n\n  if (lockout === null) {\n    return (\n      <div className=\"h-screen w-full flex items-center justify-center bg-slate-900\">\n        <Loader2 className=\"animate-spin text-blue-500\" />\n      </div>\n    );\n  }\n\n  if (lockout.active) {\n    return <LeaveLockout returnDate={lockout.returnDate!} />;\n  }\n\n  const isActive = (path: string) => pathname === path;\n\n  return (\n    <div className={`w-full max-w-[480px] h-screen relative flex flex-col overflow-hidden transition-all duration-500 bg-slate-50 dark:bg-slate-900 mx-auto shadow-2xl rounded-xl border border-slate-200 dark:border-slate-800 overscroll-none select-none`}>\n\n      {/* üî¥ Status Bar Area (Visual Only) */}\n      <div className=\"h-2 w-full bg-transparent z-50 shrink-0\" />\n\n      {/* üîí GEO LOCKOUT (Client Side Guard) */}\n      {geoConfig && (\n        <GeoLockoutOverlay\n          shopLat={geoConfig.lat}\n          shopLng={geoConfig.lng}\n          radius={geoConfig.radius}\n          bypass={geoConfig.bypass}\n        />\n      )}\n\n      {/* üü¢ MAIN CONTENT AREA */}\n      <main className=\"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar pb-32\">\n        <SyncManager />\n        {children}\n      </main>\n\n      {/* üì± THE DOCK (Floating Glass) */}\n      <div className=\"absolute bottom-6 left-4 right-4 h-20 rounded-3xl bg-[var(--glass-bg)] border border-[var(--glass-border)] shadow-[var(--glass-shadow)] backdrop-blur-xl flex justify-between items-center px-6 z-50\">\n\n        {/* HUB */}\n        <button onClick={() => router.push('/mobilepos')} className=\"group flex flex-col items-center gap-1 transition-all\">\n          <div className={`p-2 rounded-full transition-all duration-300 ${isActive('/mobilepos') ? 'bg-blue-100 text-blue-600 translate-y-[-4px]' : 'text-slate-400'}`}>\n            <Home size={22} className={isActive('/mobilepos') ? 'fill-blue-600' : ''} />\n          </div>\n          {isActive('/mobilepos') && <span className=\"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in\" />}\n        </button>\n\n        {/* STOCK */}\n        <button onClick={() => router.push('/mobilepos/inventory')} className=\"group flex flex-col items-center gap-1 transition-all\">\n          <div className={`p-2 rounded-full transition-all duration-300 ${isActive('/mobilepos/inventory') ? 'bg-blue-100 text-blue-600 translate-y-[-4px]' : 'text-slate-400'}`}>\n            <Package size={22} className={isActive('/mobilepos/inventory') ? 'fill-blue-600' : ''} />\n          </div>\n          {isActive('/mobilepos/inventory') && <span className=\"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in\" />}\n        </button>\n\n        {/* ‚ûï ACTION BUTTON (Floating Gradient) */}\n        <div className=\"relative -top-8\">\n          <button\n            onClick={() => router.push('/mobilepos/pos')}\n            className=\"w-16 h-16 rounded-full flex items-center justify-center bg-[var(--nexus-primary)] text-white shadow-2xl shadow-blue-900/30 active:scale-90 transition-all border-[4px] border-white dark:border-slate-800\"\n          >\n            <Plus size={28} strokeWidth={3} />\n          </button>\n        </div>\n\n        {/* HQ CHAT */}\n        <button onClick={() => router.push('/mobilepos/messages')} className=\"group flex flex-col items-center gap-1 transition-all\">\n          <div className={`p-2 rounded-full transition-all duration-300 ${isActive('/mobilepos/messages') ? 'bg-blue-100 text-blue-600 translate-y-[-4px]' : 'text-slate-400'}`}>\n            <MessageSquare size={22} className={isActive('/mobilepos/messages') ? 'fill-blue-600' : ''} />\n          </div>\n          {isActive('/mobilepos/messages') && <span className=\"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in\" />}\n        </button>\n\n        {/* MENU */}\n        <button onClick={() => router.push('/mobilepos/settings')} className=\"group flex flex-col items-center gap-1 transition-all\">\n          <div className={`p-2 rounded-full transition-all duration-300 ${isActive('/mobilepos/settings') ? 'bg-blue-100 text-blue-600 translate-y-[-4px]' : 'text-slate-400'}`}>\n            <Menu size={22} />\n          </div>\n          {isActive('/mobilepos/settings') && <span className=\"w-1 h-1 rounded-full bg-blue-600 animate-in fade-in\" />}\n        </button>\n\n      </div>\n    </div>\n  );\n}\n\n/**\n * üß± ROOT WRAPPER\n */\nexport default function MobilePOSLayout({ children }: { children: React.ReactNode }) {\n  return (\n    <AuthProvider>\n      <MobileThemeProvider>\n        <MobileDataProvider>\n          <div className=\"min-h-screen bg-slate-100 dark:bg-slate-950 flex justify-center items-center overflow-hidden font-sans antialiased selection:bg-blue-100\">\n            {/* üõ°Ô∏è GPS GUARD APPLIED HERE */}\n            <LocationGuard>\n              <MobileFrame>\n                {children}\n              </MobileFrame>\n            </LocationGuard>\n\n            {/* üì≤ PWA INSTALL PROMPT */}\n            <PWAInstallPrompt />\n          </div>\n        </MobileDataProvider>\n      </MobileThemeProvider>\n    </AuthProvider>\n  );\n}"],"names":[],"mappings":"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"}}]
}