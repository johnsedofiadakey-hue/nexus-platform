module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},69236,e=>{"use strict";var t=e.i(63021);let r=e.g,n=function(){if(r.prisma)return r.prisma;if(!process.env.DATABASE_URL)return new t.PrismaClient({log:[]});let e=process.env.DATABASE_URL,n=e.includes("?")?`${e}&pgbouncer=true&connection_limit=1`:`${e}?pgbouncer=true&connection_limit=1`;return new t.PrismaClient({datasources:{db:{url:n}},log:["error"]})}();e.s(["prisma",0,n])},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},18285,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},98148,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s.default}});var a=e.r(18285);Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})});var s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var i=a?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(e.r(44257));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})})},71003,e=>{"use strict";var t=e.i(98148),r=e.i(89455),n=e.i(52716);async function a(){let e=await (0,t.getServerSession)(r.authOptions);return e?.user?.email?{id:e.user.id||"",email:e.user.email,name:e.user.name||null,role:e.user.role||"WORKER",organizationId:e.user.organizationId||null}:null}async function s(){let e=await a();if(!e)throw Error("UNAUTHORIZED");return e}function o(e){return(console.error("API Error:",e),"UNAUTHORIZED"===e.message)?n.NextResponse.json({error:"Unauthorized - Please sign in"},{status:401}):"FORBIDDEN"===e.message?n.NextResponse.json({error:"Forbidden - Insufficient permissions"},{status:403}):"NO_ORGANIZATION"===e.message?n.NextResponse.json({error:"No organization assigned"},{status:400}):n.NextResponse.json({error:"Internal server error"},{status:500})}e.s(["handleApiError",()=>o,"requireAuth",()=>s])},37076,e=>{"use strict";var t=e.i(36674),r=e.i(41118),n=e.i(59617),a=e.i(52171),s=e.i(43408),o=e.i(67620),i=e.i(82397),l=e.i(27688),u=e.i(75897),p=e.i(96582),d=e.i(64108),c=e.i(18505),h=e.i(84130),m=e.i(26866),f=e.i(77048),g=e.i(93695);e.i(3348);var x=e.i(76390),R=e.i(52716),v=e.i(69236),y=e.i(71003);async function E(){try{let e=await (0,y.requireAuth)(),t="SUPER_ADMIN"!==e.role||e.organizationId?{organizationId:e.organizationId}:{},r=[],n=new Date(Date.now()-144e5),[a,s,o,i,l]=await Promise.all([v.prisma.user.findMany({where:{...t,role:"WORKER",status:"ACTIVE",attendance:{some:{checkOut:null,checkIn:{lte:n}}},sales:{none:{createdAt:{gte:n}}}},select:{id:!0,name:!0,shop:{select:{name:!0}}},take:5}),v.prisma.product.findMany({where:{stockLevel:{lte:5},shop:t},select:{id:!0,name:!0,stockLevel:!0,shop:{select:{name:!0}}},take:3}),v.prisma.sale.findMany({where:{shop:t,createdAt:{gte:n}},select:{id:!0,totalAmount:!0,createdAt:!0,user:{select:{name:!0}},shop:{select:{name:!0}}},orderBy:{createdAt:"desc"},take:5}),v.prisma.attendance.findMany({where:{checkOut:null,checkIn:{gte:n},user:t},select:{id:!0,checkIn:!0,user:{select:{name:!0,shop:{select:{name:!0}}}}},orderBy:{checkIn:"desc"},take:5}),v.prisma.dailyReport.findMany({where:{user:t,createdAt:{gte:n}},select:{id:!0,createdAt:!0,user:{select:{name:!0,shop:{select:{name:!0}}}}},orderBy:{createdAt:"desc"},take:5})]);return a.forEach(e=>{r.push({id:`ghost-${e.id}`,type:"GHOST_ALERT",user:e.name,shop:e.shop?.name||"Unknown Branch",message:"No activity recorded in 4+ hours",severity:"HIGH",timestamp:new Date})}),s.forEach(e=>{r.push({id:`stock-${e.id}`,type:"STOCK_LOW",user:"System",shop:e.shop.name,message:`${e.name} is running low (${e.stockLevel} left)`,severity:"MEDIUM",timestamp:new Date})}),o.forEach(e=>{r.push({id:`sale-${e.id}`,type:"SALE_EVENT",user:e.user.name,shop:e.shop.name,message:`Processed a ₵${e.totalAmount} transaction`,severity:e.totalAmount>=1e3?"POSITIVE":"NEUTRAL",timestamp:e.createdAt})}),i.forEach(e=>{r.push({id:`att-${e.id}`,type:"CHECK_IN",user:e.user.name,shop:e.user.shop?.name||"Unknown Branch",message:"Signed in for duty",severity:"NEUTRAL",timestamp:e.checkIn})}),l.forEach(e=>{r.push({id:`report-${e.id}`,type:"FIELD_REPORT",user:e.user.name,shop:e.user.shop?.name||"Unknown Branch",message:"Submitted a field intelligence report",severity:"NEUTRAL",timestamp:e.createdAt})}),r.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),R.NextResponse.json(r.slice(0,20))}catch(e){if(console.error("❌ PULSE_FEED_ERROR:",e),"UNAUTHORIZED"===e.message||"FORBIDDEN"===e.message)return(0,y.handleApiError)(e);return R.NextResponse.json([])}}e.s(["GET",()=>E],49952);var w=e.i(49952);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/operations/pulse-feed/route",pathname:"/api/operations/pulse-feed",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/agent/src/app/api/operations/pulse-feed/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:O,workUnitAsyncStorage:b,serverHooks:_}=A;function k(){return(0,n.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:b})}async function N(e,t,n){A.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/operations/pulse-feed/route";R=R.replace(/\/index$/,"")||"/";let v=await A.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:w,parsedUrl:O,isDraftMode:b,prerenderManifest:_,routerServerContext:k,isOnDemandRevalidate:N,revalidateOnlyGenerated:P,resolvedPathname:I,clientReferenceManifest:T,serverActionsManifest:C}=v,j=(0,i.normalizeAppPath)(R),D=!!(_.dynamicRoutes[j]||_.routes[I]),U=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,O,!1):t.end("This page could not be found"),null);if(D&&!b){let e=!!_.routes[I],t=_.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let S=null;!D||A.isDev||b||(S="/index"===(S=I)?"/":S);let q=!0===A.isDev||!D,M=D&&!q;C&&T&&(0,o.setManifestsSingleton)({page:R,clientReferenceManifest:T,serverActionsManifest:C});let H=e.method||"GET",$=(0,s.getTracer)(),L=$.getActiveScopeSpan(),B={params:E,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>A.onRequestError(e,t,n,a,k)},sharedContext:{buildId:y}},F=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let o=async e=>A.handle(z,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${R}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var s,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&N&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!D)return await (0,c.sendResponse)(F,K,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:N})},!1,k),t}},p=await A.handleResponse({req:e,nextConfig:w,cacheKey:S,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:P,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:i});if(!D)return null;if((null==p||null==(s=p.value)?void 0:s.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&D||g.delete(f.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,m.getCacheControlHeader)(p.cacheControl)),await (0,c.sendResponse)(F,K,new Response(p.value.body,{headers:g,status:p.value.status||200})),null};L?await l(L):await $.withPropagatedContext(e.headers,()=>$.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${R}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:N})},!1,k),D)throw t;return await (0,c.sendResponse)(F,K,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>k,"routeModule",()=>A,"serverHooks",()=>_,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>b],37076)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cee1b5f1._.js.map