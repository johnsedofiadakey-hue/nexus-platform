generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_URL")
  relationMode = "prisma"
}

// --- 1. ORGANIZATION ---
model Shop {
  id          String    @id @default(cuid())
  name        String
  location    String?
  phone       String?
  currency    String    @default("GHS")
  
  // ðŸ†• ADDED: Status (Required for seed)
  status      String    @default("ACTIVE") 

  // Geofencing
  latitude    Float?
  longitude   Float?
  radius      Float     @default(50)
  openingTime String?   @default("08:00")
  closingTime String?   @default("22:00")
  
  users       User[]
  products    Product[]
  sales       Sale[]
  expenses    Expense[]
  customers   Customer[]
  categories  InventoryCategory[] 

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// --- 1.1 DYNAMIC CATEGORIES ---
model InventoryCategory {
  id            String    @id @default(cuid())
  name          String
  shopId        String
  shop          Shop      @relation(fields: [shopId], references: [id], onDelete: Cascade)
  subCategories InventorySubCategory[]
  createdAt     DateTime  @default(now())
  @@index([shopId])
}

model InventorySubCategory {
  id          String    @id @default(cuid())
  name        String
  categoryId  String
  category    InventoryCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  @@index([categoryId])
}

// --- 2. USERS (HR) ---
model User {
  id               String    @id @default(cuid())
  email            String    @unique
  password         String
  name             String?
  phone            String?
  
  // ðŸ†• ADDED: Job Details (Required for seed/app)
  position         String?   @default("Staff")
  department       String?   @default("General")

  ghanaCard        String?   
  dob              DateTime? 
  image            String?   

  role             String    @default("WORKER") 
  status           String    @default("ACTIVE") 
  isInsideZone     Boolean   @default(false)
  shopId           String?
  shop             Shop?     @relation(fields: [shopId], references: [id])
  
  sales            Sale[]
  expenses         Expense[]
  attendance       Attendance[]
  dailyReports     DailyReport[]
  leaves           LeaveRequest[]
  disciplinary     DisciplinaryRecord[]
  sentMessages     Message[]  @relation("SentMessages")
  receivedMessages Message[]  @relation("ReceivedMessages")
  
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([shopId])
}

// --- 3. INVENTORY ---
model Product {
  id           String    @id @default(cuid())
  name         String    @map("productName")
  modelNumber  String?   
  description  String?   
  
  category     String    @default("General")
  subCategory  String?   @default("Unsorted")
  barcode      String?   @unique @map("sku")
  
  buyingPrice  Float     @default(0)
  sellingPrice Float     @default(0) @map("priceGHS")
  stockLevel   Int       @default(0) @map("quantity")
  minStock     Int       @default(5)
  
  shopId       String
  shop         Shop      @relation(fields: [shopId], references: [id], onDelete: Cascade)
  saleItems    SaleItem[]
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([shopId])
}

// --- 4. SALES & CUSTOMERS ---
model Sale {
  id            String    @id @default(cuid())
  totalAmount   Float
  amountPaid    Float     @default(0)
  paymentMethod String    @default("CASH")
  status        String    @default("COMPLETED")
  shopId        String
  shop          Shop      @relation(fields: [shopId], references: [id])
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  customerId    String?
  customer      Customer? @relation(fields: [customerId], references: [id])
  items         SaleItem[]
  createdAt     DateTime  @default(now())

  @@index([shopId])
  @@index([userId])
  @@index([customerId])
}

model SaleItem {
  id        String  @id @default(cuid())
  quantity  Int
  price     Float
  saleId    String
  sale      Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)
  productId String
  product   Product @relation(fields: [productId], references: [id])

  @@index([saleId])
  @@index([productId])
}

model Customer {
  id        String   @id @default(cuid())
  name      String
  phone     String?  @unique
  email     String?
  address   String?
  debt      Float    @default(0)
  shopId    String
  shop      Shop     @relation(fields: [shopId], references: [id])
  sales     Sale[]
  createdAt DateTime @default(now())

  @@index([shopId])
}

// --- 5. FINANCE ---
model Expense {
  id          String   @id @default(cuid())
  title       String
  amount      Float
  category    String
  description String?
  date        DateTime @default(now())
  shopId      String
  shop        Shop     @relation(fields: [shopId], references: [id])
  userId      String
  user        User     @relation(fields: [userId], references: [id])

  @@index([shopId])
  @@index([userId])
}

// --- 6. OPERATIONS ---
model Attendance {
  id        String    @id @default(cuid())
  checkIn   DateTime  @default(now())
  checkOut  DateTime?
  status    String    @default("PRESENT")
  note      String?
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  date      DateTime  @default(now())

  @@index([userId])
}

model DailyReport {
  id         String   @id @default(cuid())
  date       DateTime @default(now())
  totalSales Float    @default(0)
  totalCash  Float    @default(0)
  totalMomo  Float    @default(0)
  notes      String?
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
}

// --- 7. HR MODELS ---
model LeaveRequest {
  id        String   @id @default(cuid())
  type      String
  startDate DateTime
  endDate   DateTime
  reason    String?
  status    String   @default("PENDING")
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model DisciplinaryRecord {
  id          String   @id @default(cuid())
  type        String
  severity    String
  description String
  actionTaken String?
  date        DateTime @default(now())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())

  @@index([userId])
}

model Message {
  id         String   @id @default(cuid())
  content    String
  isRead     Boolean  @default(false)
  senderId   String
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiverId String
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  createdAt  DateTime @default(now())

  @@index([senderId])
  @@index([receiverId])
}